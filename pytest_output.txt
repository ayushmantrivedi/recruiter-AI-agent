============================= test session starts =============================
platform win32 -- Python 3.12.4, pytest-9.0.2, pluggy-1.6.0 -- C:\Users\ayush\AppData\Local\Programs\Python\Python312\python.exe
cachedir: .pytest_cache
rootdir: C:\Users\ayush\OneDrive\Desktop\AGENT 2
configfile: pytest.ini
plugins: anyio-3.7.1, asyncio-0.21.1, cov-4.1.0, env-1.2.0
asyncio: mode=Mode.STRICT
collecting ... collected 176 items

tests/test_api.py::TestAPIHealth::test_health_endpoint PASSED            [  0%]
tests/test_api.py::TestAPIHealth::test_api_recruiter_health_endpoint PASSED [  1%]
tests/test_api.py::TestAPIQuerySubmission::test_submit_query_success PASSED [  1%]
tests/test_api.py::TestAPIQuerySubmission::test_submit_query_background_processing PASSED [  2%]
tests/test_api.py::TestAPIQuerySubmission::test_submit_query_missing_fields PASSED [  2%]
tests/test_api.py::TestAPIQuerySubmission::test_submit_query_invalid_data PASSED [  3%]
tests/test_api.py::TestAPIQuerySubmission::test_submit_query_pipeline_error PASSED [  3%]
tests/test_api.py::TestAPIQueryStatus::test_get_query_status_completed PASSED [  4%]
tests/test_api.py::TestAPIQueryStatus::test_get_query_status_processing PASSED [  5%]
tests/test_api.py::TestAPIQueryStatus::test_get_query_status_not_found PASSED [  5%]
tests/test_api.py::TestAPIQueryStatus::test_get_query_status_pipeline_error PASSED [  6%]
tests/test_api.py::TestAPIDataValidation::test_query_request_validation PASSED [  6%]
tests/test_api.py::TestAPIErrorHandling::test_invalid_json PASSED        [  7%]
tests/test_api.py::TestAPIErrorHandling::test_unsupported_content_type FAILED [  7%]
tests/test_api.py::TestAPIErrorHandling::test_method_not_allowed PASSED  [  8%]
tests/test_api.py::TestAPIRateLimiting::test_concurrent_requests PASSED  [  9%]
tests/test_api.py::TestAPIMetrics::test_metrics_endpoints_exist PASSED   [  9%]
tests/test_api.py::test_concurrent_job_execution FAILED                  [ 10%]
tests/test_api.py::test_job_recovery_mechanism FAILED                    [ 10%]
tests/test_api.py::test_job_timeout_mechanism FAILED                     [ 11%]
tests/test_api_contract.py::test_intelligence_schema_validation PASSED   [ 11%]
tests/test_api_contract.py::test_output_determinism PASSED               [ 12%]
tests/test_api_contract.py::test_backward_compatibility PASSED           [ 13%]
tests/test_async_pipeline_fix.py::test_async_pipeline_execution_calls_orchestrator PASSED [ 13%]
tests/test_async_pipeline_fix.py::test_pipeline_interface_integrity PASSED [ 14%]
tests/test_cli.py::TestConfig::test_config_initialization PASSED         [ 14%]
tests/test_cli.py::TestConfig::test_config_set_get PASSED                [ 15%]
tests/test_cli.py::TestConfig::test_config_get_default PASSED            [ 15%]
tests/test_cli.py::TestAPIClient::test_health_check_success PASSED       [ 16%]
tests/test_cli.py::TestAPIClient::test_submit_query_success PASSED       [ 17%]
tests/test_cli.py::TestAPIClient::test_get_query_status_success PASSED   [ 17%]
tests/test_cli.py::TestCLICommands::test_health_command_success PASSED   [ 18%]
tests/test_cli.py::TestCLICommands::test_health_command_failure PASSED   [ 18%]
tests/test_cli.py::TestCLICommands::test_query_command_success FAILED    [ 19%]
tests/test_cli.py::TestCLICommands::test_query_command_with_wait FAILED  [ 19%]
tests/test_cli.py::TestCLICommands::test_status_command_success PASSED   [ 20%]
tests/test_cli.py::TestCLICommands::test_results_command_success PASSED  [ 21%]
tests/test_cli.py::TestCLICommands::test_results_command_json_output FAILED [ 21%]
tests/test_cli.py::TestCLICommands::test_config_command_get PASSED       [ 22%]
tests/test_cli.py::TestCLICommands::test_config_command_set PASSED       [ 22%]
tests/test_contract_validation.py::test_total_leads_found_accuracy PASSED [ 23%]
tests/test_contract_validation.py::test_total_leads_found_greater_or_equal PASSED [ 23%]
tests/test_contract_validation.py::test_api_response_has_required_fields PASSED [ 24%]
tests/test_contract_validation.py::test_deduplication_metrics_present FAILED [ 25%]
tests/test_contract_validation.py::test_lead_has_required_fields PASSED  [ 25%]
tests/test_contract_validation.py::test_no_duplicate_companies_in_output PASSED [ 26%]
tests/test_contract_validation.py::test_score_distribution_has_variance PASSED [ 26%]
tests/test_critical_hardening.py::test_pipeline_composition PASSED       [ 27%]
tests/test_critical_hardening.py::test_startup_validation PASSED         [ 27%]
tests/test_critical_hardening.py::test_job_structure_determinism FAILED  [ 28%]
tests/test_critical_hardening.py::test_stability_loop PASSED             [ 28%]
tests/test_critical_hardening.py::test_pipeline_failure_handling PASSED  [ 29%]
tests/test_deduplication.py::test_deduplication_removes_exact_duplicates PASSED [ 30%]
tests/test_deduplication.py::test_deduplication_preserves_highest_score PASSED [ 30%]
tests/test_deduplication.py::test_deduplication_handles_case_insensitive PASSED [ 31%]
tests/test_deduplication.py::test_deduplication_different_companies_preserved PASSED [ 31%]
tests/test_deduplication.py::test_deduplication_different_roles_preserved PASSED [ 32%]
tests/test_deduplication.py::test_deduplication_different_locations_preserved PASSED [ 32%]
tests/test_deduplication.py::test_deduplication_handles_empty_list PASSED [ 33%]
tests/test_deduplication.py::test_deduplication_handles_single_lead PASSED [ 34%]
tests/test_deduplication.py::test_deduplication_skips_empty_company FAILED [ 34%]
tests/test_deduplication.py::test_deduplication_maintains_sort_order PASSED [ 35%]
tests/test_execution_reporting.py::test_execution_report_structure PASSED [ 35%]
tests/test_execution_reporting.py::test_pipeline_persistence FAILED      [ 36%]
tests/test_execution_reporting.py::test_contract_integrity PASSED        [ 36%]
tests/test_full_pipeline.py::test_pipeline_integration_with_search FAILED [ 37%]
tests/test_intelligence_engine.py::test_intent_hiring PASSED             [ 38%]
tests/test_intelligence_engine.py::test_intent_salary PASSED             [ 38%]
tests/test_intelligence_engine.py::test_intent_research PASSED           [ 39%]
tests/test_intelligence_engine.py::test_extraction_complex PASSED        [ 39%]
tests/test_intelligence_engine.py::test_signal_ordering FAILED           [ 40%]
tests/test_intelligence_engine.py::test_stability FAILED                 [ 40%]
tests/test_intelligence_engine.py::test_boundary_general FAILED          [ 41%]
tests/test_intelligence_engine.py::test_robustness FAILED                [ 42%]
tests/test_lead_enrichment.py::test_enrichment_fills_required_fields FAILED [ 42%]
tests/test_lead_enrichment.py::test_enrichment_injects_intelligence_metadata PASSED [ 43%]
tests/test_lead_enrichment.py::test_enrichment_does_not_overwrite_existing_fields PASSED [ 43%]
tests/test_lead_enrichment.py::test_enriched_lead_passes_contract_validation FAILED [ 44%]
tests/test_lead_enrichment.py::test_enrichment_handles_missing_confidence_score PASSED [ 44%]
tests/test_lead_enrichment.py::test_enrichment_batch_processing PASSED   [ 45%]
tests/test_lead_enrichment.py::test_enrichment_adds_company_alias PASSED [ 46%]
tests/test_lead_enrichment.py::test_end_to_end_enrichment_in_pipeline FAILED [ 46%]
tests/test_lead_ranking.py::test_ranking_order PASSED                    [ 47%]
tests/test_lead_scoring.py::test_score_calculation FAILED                [ 47%]
tests/test_lead_scoring.py::test_low_score_calculation FAILED            [ 48%]
tests/test_lead_scoring.py::test_missing_signals FAILED                  [ 48%]
tests/test_observability.py::test_orchestration_summary_present FAILED   [ 49%]
tests/test_observability.py::test_provider_telemetry_attached FAILED     [ 50%]
tests/test_observability.py::test_total_leads_found_fidelity PASSED      [ 50%]
tests/test_observability.py::test_execution_mode_logging_config PASSED   [ 51%]
tests/test_pipeline.py::test_simple PASSED                               [ 51%]
tests/test_pipeline.py::TestRecruiterPipeline::test_pipeline_basic PASSED [ 52%]
tests/test_pipeline.py::TestRecruiterPipeline::test_action_orchestrator_structure PASSED [ 52%]
tests/test_pipeline.py::TestRecruiterPipeline::test_signal_judge_data_structure PASSED [ 53%]
tests/test_pipeline.py::TestRecruiterPipeline::test_scoring_weights_configuration PASSED [ 53%]
tests/test_pipeline.py::TestAPIs::test_job_api_structure PASSED          [ 54%]
tests/test_pipeline.py::TestAPIs::test_news_api_structure PASSED         [ 55%]
tests/test_pipeline.py::TestDatabaseModels::test_database_imports PASSED [ 55%]
tests/test_pipeline.py::test_full_pipeline_integration SKIPPED (Requ...) [ 56%]
tests/test_pipeline_contract.py::test_lead_contract_strips_unknown_fields FAILED [ 56%]
tests/test_pipeline_contract.py::test_lead_contract_normalizes_company_field PASSED [ 57%]
tests/test_pipeline_contract.py::test_lead_contract_defaults_missing_company PASSED [ 57%]
tests/test_pipeline_contract.py::test_lead_contract_validates_required_fields PASSED [ 58%]
tests/test_pipeline_contract.py::test_lead_contract_clamps_numeric_values PASSED [ 59%]
tests/test_pipeline_contract.py::test_lead_contract_ensures_json_fields_are_lists PASSED [ 59%]
tests/test_pipeline_contract.py::test_location_contract_end_to_end FAILED [ 60%]
tests/test_pipeline_contract.py::test_schema_drift_protection PASSED     [ 60%]
tests/test_pipeline_contract.py::test_partial_failure_handling FAILED    [ 61%]
tests/test_pipeline_stress.py::test_lead_validator_fixes_missing_company PASSED [ 61%]
tests/test_pipeline_stress.py::test_lead_validator_enforces_numeric_types PASSED [ 62%]
tests/test_pipeline_stress.py::test_search_orchestrator_respects_location_contract FAILED [ 63%]
tests/test_pipeline_stress.py::test_pipeline_validation_gate_unit FAILED [ 63%]
tests/test_pipeline_stress.py::test_end_to_end_location_contract FAILED  [ 64%]
tests/test_platform_unification.py::TestSingleExecutionPath::test_sync_and_async_paths_use_same_pipeline PASSED [ 64%]
tests/test_platform_unification.py::TestSingleExecutionPath::test_legacy_checkpoint_function_removed PASSED [ 65%]
tests/test_platform_unification.py::TestSingleExecutionPath::test_execution_report_always_created PASSED [ 65%]
tests/test_platform_unification.py::TestStartupIntegrity::test_verify_search_providers_exists PASSED [ 66%]
tests/test_platform_unification.py::TestStartupIntegrity::test_verify_database_schema_checks_execution_reports PASSED [ 67%]
tests/test_platform_unification.py::TestStartupIntegrity::test_search_orchestrator_has_active_providers PASSED [ 67%]
tests/test_platform_unification.py::TestStartupIntegrity::test_zero_providers_raises_error FAILED [ 68%]
tests/test_platform_unification.py::TestExecutionConsistency::test_total_leads_found_matches_raw_count PASSED [ 68%]
tests/test_platform_unification.py::TestExecutionConsistency::test_orchestration_summary_populated FAILED [ 69%]
tests/test_production_hardening.py::test_score_soft_cap_prevents_saturation FAILED [ 69%]
tests/test_production_hardening.py::test_deduplication_removes_duplicates FAILED [ 70%]
tests/test_production_hardening.py::test_deduplication_preserves_order FAILED [ 71%]
tests/test_production_hardening.py::test_reasons_populated_from_signals PASSED [ 71%]
tests/test_production_hardening.py::test_reasons_reflect_signal_values PASSED [ 72%]
tests/test_production_hardening.py::test_total_leads_found_accuracy PASSED [ 72%]
tests/test_production_hardening.py::test_score_distribution_not_clustered FAILED [ 73%]
tests/test_production_hardening.py::test_end_to_end_hardening FAILED     [ 73%]
tests/test_query_read_model.py::test_query_status_returns_leads FAILED   [ 74%]
tests/test_query_read_model.py::test_no_evidence_count_in_lead_model PASSED [ 75%]
tests/test_query_read_model.py::test_api_response_serialization FAILED   [ 75%]
tests/test_query_read_model.py::test_end_to_end_query_and_retrieve FAILED [ 76%]
tests/test_score_distribution.py::test_score_range_enforcement PASSED    [ 76%]
tests/test_score_distribution.py::test_score_variance_with_different_signals PASSED [ 77%]
tests/test_score_distribution.py::test_score_distribution_has_spread PASSED [ 77%]
tests/test_score_distribution.py::test_score_no_clustering_at_top PASSED [ 78%]
tests/test_score_distribution.py::test_confidence_realistic_range PASSED [ 78%]
tests/test_score_distribution.py::test_confidence_never_exceeds_95 PASSED [ 79%]
tests/test_score_distribution.py::test_confidence_never_below_40 PASSED  [ 80%]
tests/test_score_distribution.py::test_confidence_evidence_boost PASSED  [ 80%]
tests/test_score_distribution.py::test_confidence_source_reliability PASSED [ 81%]
tests/test_score_distribution.py::test_score_distribution_validation_warning PASSED [ 81%]
tests/test_search_engine.py::test_lead_normalization_defaults FAILED     [ 82%]
tests/test_search_engine.py::test_lead_normalization_with_all_fields FAILED [ 82%]
tests/test_search_engine.py::test_lead_normalization_inference FAILED    [ 83%]
tests/test_search_integrity.py::test_startup_fails_with_no_providers FAILED [ 84%]
tests/test_search_integrity.py::test_search_mode_provider_logic FAILED   [ 84%]
tests/test_search_integrity.py::test_telemetry_generation FAILED         [ 85%]
tests/test_strict_compliance.py::test_determinism FAILED                 [ 85%]
tests/test_strict_compliance.py::test_sensitivity FAILED                 [ 86%]
tests/test_strict_compliance.py::test_location_competition FAILED        [ 86%]
tests/test_strict_compliance.py::test_intent_control FAILED              [ 87%]
tests/test_strict_compliance.py::test_broken_grammar FAILED              [ 88%]
tests/test_strict_compliance.py::test_aliases FAILED                     [ 88%]
tests/test_strict_compliance.py::test_noise FAILED                       [ 89%]
tests/test_strict_compliance.py::test_e2e_api_contract FAILED            [ 89%]
tests/test_strict_compliance.py::test_async_completion_guarantee FAILED  [ 90%]
tests/test_strict_compliance.py::test_schema_integrity FAILED            [ 90%]
tests/test_strict_compliance.py::test_transaction_atomicity FAILED       [ 91%]
tests/test_total_leads_contract.py::TestTotalLeadsFoundContract::test_total_leads_found_matches_raw_leads FAILED [ 92%]
tests/test_total_leads_contract.py::TestTotalLeadsFoundContract::test_orchestration_summary_populated FAILED [ 92%]
tests/test_total_leads_contract.py::TestTotalLeadsFoundContract::test_contract_invariant_enforcement PASSED [ 93%]
tests/test_total_leads_contract.py::TestTotalLeadsFoundContract::test_search_orchestrator_report_integrity PASSED [ 93%]
tests/test_ui.py::TestUIRoutes::test_ui_home_page FAILED                 [ 94%]
tests/test_ui.py::TestUIRoutes::test_ui_query_submission_success FAILED  [ 94%]
tests/test_ui.py::TestUIRoutes::test_ui_query_submission_completed FAILED [ 95%]
tests/test_ui.py::TestUIRoutes::test_ui_query_submission_failed FAILED   [ 96%]
tests/test_ui.py::TestUIRoutes::test_ui_query_status_polling FAILED      [ 96%]
tests/test_ui.py::TestUIRoutes::test_ui_query_status_polling_failed FAILED [ 97%]
tests/test_ui.py::TestUITemplates::test_home_template_structure FAILED   [ 97%]
tests/test_ui.py::TestUITemplates::test_query_result_template_processing FAILED [ 98%]
tests/test_ui.py::TestUITemplates::test_query_result_template_completed FAILED [ 98%]
tests/test_ui.py::TestUITemplates::test_query_result_template_failed FAILED [ 99%]
tests/test_ui.py::TestUIStaticFiles::test_static_files_mounted PASSED    [100%]

================================== FAILURES ===================================
_____________ TestAPIErrorHandling.test_unsupported_content_type ______________

self = <tests.test_api.TestAPIErrorHandling object at 0x00000286DE778A10>
client = <starlette.testclient.TestClient object at 0x00000286DFBCA810>

    def test_unsupported_content_type(self, client):
        """Test handling of unsupported content types."""
        response = client.post(
            "/api/recruiter/query",
            data="query=Find Python developers",
            headers={"Content-Type": "application/x-www-form-urlencoded"}
        )
    
>       assert response.status_code == 422
E       assert 200 == 422
E        +  where 200 = <Response [200 OK]>.status_code

tests\test_api.py:235: AssertionError
---------------------------- Captured stdout call -----------------------------
\x1b[2m2026-02-01T13:19:22.089204Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:22.090708Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mParsed form input             \x1b[0m \x1b[36mcontent_type\x1b[0m=\x1b[35mapplication/x-www-form-urlencoded\x1b[0m\n\x1b[2m2026-02-01T13:19:22.090708Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mInput normalized successfully \x1b[0m \x1b[36mhas_recruiter_id\x1b[0m=\x1b[35mFalse\x1b[0m \x1b[36mquery_length\x1b[0m=\x1b[35m22\x1b[0m\n\x1b[2m2026-02-01T13:19:22.090708Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting recruiter query processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35manonymous\x1b[0m\n\x1b[2m2026-02-01T13:19:22.090708Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 1: Intelligence Engine   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:22.090708Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 2: Search & Ranking Orchestration\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:22.090708Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting Search Orchestration \x1b[0m \x1b[36mmode\x1b[0m=\x1b[35mdev\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:22.090708Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mQuery parsed: Find Python developers, Role: find python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:22.090708Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching from JobAPIManager: Find Python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:22.090708Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRealTimeWebScraper: Searching for 'Find Python developers'\x1b[0m\n\x1b[2m2026-02-01T13:19:22.411033Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching Arbeitnow jobs       \x1b[0m \x1b[36mparams\x1b[0m=\x1b[35m{'search': 'find python developers', 'location': 'remote', 'limit': 2}\x1b[0m\n\x1b[2m2026-02-01T13:19:22.411033Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35marbeitnow\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://www.arbeitnow.com/api/job-board-api\x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.0\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mFalse\x1b[0m\n\x1b[2m2026-02-01T13:19:22.411033Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mArbeitnow API call failed     \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m\n\x1b[2m2026-02-01T13:19:22.411033Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching RemoteOK jobs        \x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mfind python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:22.604418Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35mremoteok\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://remoteok.com/api\x1b[0m \x1b[36mjobs_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.20299999999406282\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mTrue\x1b[0m\n\x1b[2m2026-02-01T13:19:22.604418Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob search completed          \x1b[0m \x1b[36mapis_called\x1b[0m=\x1b[35m2\x1b[0m \x1b[36mtotal_jobs\x1b[0m=\x1b[35m3\x1b[0m \x1b[36munique_jobs\x1b[0m=\x1b[35m3\x1b[0m\n\x1b[2m2026-02-01T13:19:26.404846Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mRealTimeWebScraper failed: \x1b[0m\n\x1b[2m2026-02-01T13:19:26.404846Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetched 3 raw leads           \x1b[0m \x1b[36mtelemetry\x1b[0m=\x1b[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 1.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 513.71, 'leads_found': 3}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4314.14, 'leads_found': 0}}\x1b[0m\n\x1b[2m2026-02-01T13:19:26.404846Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mScoring distribution          \x1b[0m \x1b[36mmax\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmean\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmin\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mstd_dev\x1b[0m=\x1b[35m0.0\x1b[0m\n\x1b[2m2026-02-01T13:19:26.404846Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mDeduplication & Density Check complete\x1b[0m \x1b[36mfinal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36moriginal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36msemantic_duplicates\x1b[0m=\x1b[35m0\x1b[0m\n\x1b[2m2026-02-01T13:19:26.404846Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mEnriched 3 leads with intelligence data\x1b[0m\n\x1b[2m2026-02-01T13:19:26.404846Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 3: Generating synthesis report\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:26.404846Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGenerating briefing           \x1b[0m \x1b[36mmodel\x1b[0m=\x1b[35mopenai/gpt-3.5-turbo\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.148833Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mBriefing generated successfully\x1b[0m \x1b[36mlength\x1b[0m=\x1b[35m1072\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.148833Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_STARTED             \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.151851Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4dd UPDATING_EXISTING_QUERY_RECORD\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.151851Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4ca DB_SAVE_EXECUTION_REPORT    \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.151851Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f465 DB_SAVE_LEADS_STARTED       \x1b[0m \x1b[36mlead_count\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.152357Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f504 DB_TRANSACTION_COMMIT_STARTED\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.152357Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 DB_TRANSACTION_COMMIT_COMPLETED\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.152748Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_COMPLETED_SUCCESSFULLY\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.152748Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRecruiter query processing completed\x1b[0m \x1b[36mleads_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mprocessing_time\x1b[0m=\x1b[35m7.058125\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m5a62d6a8-a6bc-4f29-919d-e05dad1ccab8\x1b[0m\n\x1b[2m2026-02-01T13:19:29.153406Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m7.064\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m200\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m
________________________ test_concurrent_job_execution ________________________

    @pytest.mark.asyncio
    async def test_concurrent_job_execution():
        """Stress test: Submit multiple jobs concurrently and verify completion."""
        import asyncio
        import time
    
        # Test configuration
        CONCURRENT_JOBS = 5
        TEST_TIMEOUT = 60  # seconds
    
        client = TestClient(app)
        job_ids = []
    
        # Submit multiple jobs concurrently
        start_time = time.time()
    
        async def submit_job(job_num: int):
            """Submit a single job."""
            query = f"Find Python developers job {job_num}"
            response = client.post("/api/recruiter/query", json={
                "query": query,
                "recruiter_id": f"test-user-{job_num}"
            })
    
            assert response.status_code == 200
            data = response.json()
            assert "query_id" in data
            return data["query_id"], query
    
        # Submit all jobs concurrently
        print(f"Submitting {CONCURRENT_JOBS} concurrent jobs...")
        submit_tasks = [submit_job(i) for i in range(CONCURRENT_JOBS)]
        submit_results = await asyncio.gather(*submit_tasks)
    
        job_ids = [job_id for job_id, _ in submit_results]
        print(f"Submitted jobs: {job_ids}")
    
        # Wait for all jobs to complete
        async def wait_for_completion(job_id: str, timeout_seconds: int = TEST_TIMEOUT):
            """Wait for a job to complete."""
            start_poll = time.time()
    
            while time.time() - start_poll < timeout_seconds:
                response = client.get(f"/api/recruiter/query/{job_id}")
                assert response.status_code == 200
    
                data = response.json()
                status = data.get("status")
    
                if status == "completed":
                    return True, data
                elif status == "failed":
                    return False, data
    
                # Wait before polling again
                await asyncio.sleep(0.5)
    
            # Timeout reached
            return False, {"status": "timeout", "query_id": job_id}
    
        # Poll all jobs concurrently
        print("Waiting for all jobs to complete...")
        poll_tasks = [wait_for_completion(job_id) for job_id in job_ids]
>       poll_results = await asyncio.gather(*poll_tasks)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_api.py:340: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

job_id = '9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f', timeout_seconds = 60

    async def wait_for_completion(job_id: str, timeout_seconds: int = TEST_TIMEOUT):
        """Wait for a job to complete."""
        start_poll = time.time()
    
        while time.time() - start_poll < timeout_seconds:
            response = client.get(f"/api/recruiter/query/{job_id}")
>           assert response.status_code == 200
E           assert 404 == 200
E            +  where 404 = <Response [404 Not Found]>.status_code

tests\test_api.py:321: AssertionError
---------------------------- Captured stdout call -----------------------------
Submitting 5 concurrent jobs...\n\x1b[2m2026-02-01T13:19:29.452063Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:29.452063Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mParsed JSON input             \x1b[0m \x1b[36mcontent_type\x1b[0m=\x1b[35mapplication/json\x1b[0m\n\x1b[2m2026-02-01T13:19:29.452063Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mInput normalized successfully \x1b[0m \x1b[36mhas_recruiter_id\x1b[0m=\x1b[35mTrue\x1b[0m \x1b[36mquery_length\x1b[0m=\x1b[35m28\x1b[0m\n\x1b[2m2026-02-01T13:19:29.454228Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob created and queued for processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 0\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-0\x1b[0m\n\x1b[2m2026-02-01T13:19:29.454228Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m0.002\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m200\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:29.455986Z\x1b[0m [\x1b[33m\x1b[1mwarning  \x1b[0m] \x1b[1m\u26a0\ufe0f JOB_ALREADY_IN_PROCESSING  \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m \x1b[36mstatus\x1b[0m=\x1b[35mprocessing\x1b[0m\n\x1b[2m2026-02-01T13:19:29.455986Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f680 JOB_STARTED                 \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mmax_attempts\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:29.456998Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting recruiter query processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 0\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-0\x1b[0m\n\x1b[2m2026-02-01T13:19:29.456998Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 1: Intelligence Engine   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:29.456998Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 2: Search & Ranking Orchestration\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:29.456998Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting Search Orchestration \x1b[0m \x1b[36mmode\x1b[0m=\x1b[35mdev\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 0\x1b[0m\n\x1b[2m2026-02-01T13:19:29.456998Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mQuery parsed: Find Python developers job 0, Role: find python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:29.456998Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching from JobAPIManager: Find Python developers job 0\x1b[0m\n\x1b[2m2026-02-01T13:19:29.456998Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRealTimeWebScraper: Searching for 'Find Python developers job 0'\x1b[0m\n\x1b[2m2026-02-01T13:19:29.766742Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching Arbeitnow jobs       \x1b[0m \x1b[36mparams\x1b[0m=\x1b[35m{'search': 'find python developers', 'location': 'remote', 'limit': 2}\x1b[0m\n\x1b[2m2026-02-01T13:19:29.766742Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35marbeitnow\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://www.arbeitnow.com/api/job-board-api\x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.0\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mFalse\x1b[0m\n\x1b[2m2026-02-01T13:19:29.766742Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mArbeitnow API call failed     \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m\n\x1b[2m2026-02-01T13:19:29.766742Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching RemoteOK jobs        \x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mfind python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:29.957558Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35mremoteok\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://remoteok.com/api\x1b[0m \x1b[36mjobs_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.1870000000053551\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mTrue\x1b[0m\n\x1b[2m2026-02-01T13:19:29.957558Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob search completed          \x1b[0m \x1b[36mapis_called\x1b[0m=\x1b[35m2\x1b[0m \x1b[36mtotal_jobs\x1b[0m=\x1b[35m3\x1b[0m \x1b[36munique_jobs\x1b[0m=\x1b[35m3\x1b[0m\n\x1b[2m2026-02-01T13:19:33.770820Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mRealTimeWebScraper failed: \x1b[0m\n\x1b[2m2026-02-01T13:19:33.770820Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetched 3 raw leads           \x1b[0m \x1b[36mtelemetry\x1b[0m=\x1b[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 500.56, 'leads_found': 3}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4313.82, 'leads_found': 0}}\x1b[0m\n\x1b[2m2026-02-01T13:19:33.770820Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mScoring distribution          \x1b[0m \x1b[36mmax\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmean\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmin\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mstd_dev\x1b[0m=\x1b[35m0.0\x1b[0m\n\x1b[2m2026-02-01T13:19:33.770820Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mDeduplication & Density Check complete\x1b[0m \x1b[36mfinal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36moriginal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36msemantic_duplicates\x1b[0m=\x1b[35m0\x1b[0m\n\x1b[2m2026-02-01T13:19:33.770820Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mEnriched 3 leads with intelligence data\x1b[0m\n\x1b[2m2026-02-01T13:19:33.770820Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 3: Generating synthesis report\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:33.770820Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGenerating briefing           \x1b[0m \x1b[36mmodel\x1b[0m=\x1b[35mopenai/gpt-3.5-turbo\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.578843Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mBriefing generated successfully\x1b[0m \x1b[36mlength\x1b[0m=\x1b[35m1358\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.578843Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_STARTED             \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.581494Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4dd UPDATING_EXISTING_QUERY_RECORD\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.583109Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4ca DB_SAVE_EXECUTION_REPORT    \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.583109Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f465 DB_SAVE_LEADS_STARTED       \x1b[0m \x1b[36mlead_count\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.583705Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f504 DB_TRANSACTION_COMMIT_STARTED\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.583705Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 DB_TRANSACTION_COMMIT_COMPLETED\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.583705Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_COMPLETED_SUCCESSFULLY\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.583705Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRecruiter query processing completed\x1b[0m \x1b[36mleads_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mprocessing_time\x1b[0m=\x1b[35m7.121845\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.583705Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 JOB_COMPLETED_SUCCESSFULLY  \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:19:36.587962Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:36.588987Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mParsed JSON input             \x1b[0m \x1b[36mcontent_type\x1b[0m=\x1b[35mapplication/json\x1b[0m\n\x1b[2m2026-02-01T13:19:36.588987Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mInput normalized successfully \x1b[0m \x1b[36mhas_recruiter_id\x1b[0m=\x1b[35mTrue\x1b[0m \x1b[36mquery_length\x1b[0m=\x1b[35m28\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob created and queued for processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 1\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-1\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m0.002\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m200\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[33m\x1b[1mwarning  \x1b[0m] \x1b[1m\u26a0\ufe0f JOB_ALREADY_IN_PROCESSING  \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m \x1b[36mstatus\x1b[0m=\x1b[35mprocessing\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f680 JOB_STARTED                 \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mmax_attempts\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting recruiter query processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 1\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-1\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 1: Intelligence Engine   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 2: Search & Ranking Orchestration\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting Search Orchestration \x1b[0m \x1b[36mmode\x1b[0m=\x1b[35mdev\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 1\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mQuery parsed: Find Python developers job 1, Role: find python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching from JobAPIManager: Find Python developers job 1\x1b[0m\n\x1b[2m2026-02-01T13:19:36.590032Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRealTimeWebScraper: Searching for 'Find Python developers job 1'\x1b[0m\n\x1b[2m2026-02-01T13:19:36.895835Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching Arbeitnow jobs       \x1b[0m \x1b[36mparams\x1b[0m=\x1b[35m{'search': 'find python developers', 'location': 'remote', 'limit': 2}\x1b[0m\n\x1b[2m2026-02-01T13:19:36.895835Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35marbeitnow\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://www.arbeitnow.com/api/job-board-api\x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.0\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mFalse\x1b[0m\n\x1b[2m2026-02-01T13:19:36.895835Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mArbeitnow API call failed     \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m\n\x1b[2m2026-02-01T13:19:36.895835Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching RemoteOK jobs        \x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mfind python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:37.075255Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35mremoteok\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://remoteok.com/api\x1b[0m \x1b[36mjobs_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.17200000000593718\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mTrue\x1b[0m\n\x1b[2m2026-02-01T13:19:37.075255Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob search completed          \x1b[0m \x1b[36mapis_called\x1b[0m=\x1b[35m2\x1b[0m \x1b[36mtotal_jobs\x1b[0m=\x1b[35m3\x1b[0m \x1b[36munique_jobs\x1b[0m=\x1b[35m3\x1b[0m\n\x1b[2m2026-02-01T13:19:40.917167Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mRealTimeWebScraper failed: \x1b[0m\n\x1b[2m2026-02-01T13:19:40.917167Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetched 3 raw leads           \x1b[0m \x1b[36mtelemetry\x1b[0m=\x1b[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 485.22, 'leads_found': 3}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4327.14, 'leads_found': 0}}\x1b[0m\n\x1b[2m2026-02-01T13:19:40.917167Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mScoring distribution          \x1b[0m \x1b[36mmax\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmean\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmin\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mstd_dev\x1b[0m=\x1b[35m0.0\x1b[0m\n\x1b[2m2026-02-01T13:19:40.917167Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mDeduplication & Density Check complete\x1b[0m \x1b[36mfinal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36moriginal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36msemantic_duplicates\x1b[0m=\x1b[35m0\x1b[0m\n\x1b[2m2026-02-01T13:19:40.917167Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mEnriched 3 leads with intelligence data\x1b[0m\n\x1b[2m2026-02-01T13:19:40.917167Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 3: Generating synthesis report\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:40.917167Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGenerating briefing           \x1b[0m \x1b[36mmodel\x1b[0m=\x1b[35mopenai/gpt-3.5-turbo\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.104091Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mBriefing generated successfully\x1b[0m \x1b[36mlength\x1b[0m=\x1b[35m1258\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.104091Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_STARTED             \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.106103Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4dd UPDATING_EXISTING_QUERY_RECORD\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.106103Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4ca DB_SAVE_EXECUTION_REPORT    \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.106103Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f465 DB_SAVE_LEADS_STARTED       \x1b[0m \x1b[36mlead_count\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.106103Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f504 DB_TRANSACTION_COMMIT_STARTED\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.106103Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 DB_TRANSACTION_COMMIT_COMPLETED\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.106103Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_COMPLETED_SUCCESSFULLY\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.106103Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRecruiter query processing completed\x1b[0m \x1b[36mleads_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mprocessing_time\x1b[0m=\x1b[35m7.514059\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.106103Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 JOB_COMPLETED_SUCCESSFULLY  \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:19:44.110117Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:44.110117Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mParsed JSON input             \x1b[0m \x1b[36mcontent_type\x1b[0m=\x1b[35mapplication/json\x1b[0m\n\x1b[2m2026-02-01T13:19:44.111624Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mInput normalized successfully \x1b[0m \x1b[36mhas_recruiter_id\x1b[0m=\x1b[35mTrue\x1b[0m \x1b[36mquery_length\x1b[0m=\x1b[35m28\x1b[0m\n\x1b[2m2026-02-01T13:19:44.111624Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob created and queued for processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 2\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-2\x1b[0m\n\x1b[2m2026-02-01T13:19:44.111624Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m0.002\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m200\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:44.113137Z\x1b[0m [\x1b[33m\x1b[1mwarning  \x1b[0m] \x1b[1m\u26a0\ufe0f JOB_ALREADY_IN_PROCESSING  \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m \x1b[36mstatus\x1b[0m=\x1b[35mprocessing\x1b[0m\n\x1b[2m2026-02-01T13:19:44.113137Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f680 JOB_STARTED                 \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mmax_attempts\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:44.113137Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting recruiter query processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 2\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-2\x1b[0m\n\x1b[2m2026-02-01T13:19:44.113137Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 1: Intelligence Engine   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:44.113137Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 2: Search & Ranking Orchestration\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:44.113137Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting Search Orchestration \x1b[0m \x1b[36mmode\x1b[0m=\x1b[35mdev\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 2\x1b[0m\n\x1b[2m2026-02-01T13:19:44.113137Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mQuery parsed: Find Python developers job 2, Role: find python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:44.113137Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching from JobAPIManager: Find Python developers job 2\x1b[0m\n\x1b[2m2026-02-01T13:19:44.113137Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRealTimeWebScraper: Searching for 'Find Python developers job 2'\x1b[0m\n\x1b[2m2026-02-01T13:19:44.434631Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching Arbeitnow jobs       \x1b[0m \x1b[36mparams\x1b[0m=\x1b[35m{'search': 'find python developers', 'location': 'remote', 'limit': 2}\x1b[0m\n\x1b[2m2026-02-01T13:19:44.438236Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35marbeitnow\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://www.arbeitnow.com/api/job-board-api\x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.0\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mFalse\x1b[0m\n\x1b[2m2026-02-01T13:19:44.438236Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mArbeitnow API call failed     \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m\n\x1b[2m2026-02-01T13:19:44.438236Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching RemoteOK jobs        \x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mfind python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:44.671801Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35mremoteok\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://remoteok.com/api\x1b[0m \x1b[36mjobs_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.23500000000058208\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mTrue\x1b[0m\n\x1b[2m2026-02-01T13:19:44.671801Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob search completed          \x1b[0m \x1b[36mapis_called\x1b[0m=\x1b[35m2\x1b[0m \x1b[36mtotal_jobs\x1b[0m=\x1b[35m3\x1b[0m \x1b[36munique_jobs\x1b[0m=\x1b[35m3\x1b[0m\n\x1b[2m2026-02-01T13:19:48.436126Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mRealTimeWebScraper failed: \x1b[0m\n\x1b[2m2026-02-01T13:19:48.436126Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetched 3 raw leads           \x1b[0m \x1b[36mtelemetry\x1b[0m=\x1b[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 558.66, 'leads_found': 3}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4322.99, 'leads_found': 0}}\x1b[0m\n\x1b[2m2026-02-01T13:19:48.436126Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mScoring distribution          \x1b[0m \x1b[36mmax\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmean\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmin\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mstd_dev\x1b[0m=\x1b[35m0.0\x1b[0m\n\x1b[2m2026-02-01T13:19:48.436126Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mDeduplication & Density Check complete\x1b[0m \x1b[36mfinal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36moriginal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36msemantic_duplicates\x1b[0m=\x1b[35m0\x1b[0m\n\x1b[2m2026-02-01T13:19:48.436126Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mEnriched 3 leads with intelligence data\x1b[0m\n\x1b[2m2026-02-01T13:19:48.436126Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 3: Generating synthesis report\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:48.436126Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGenerating briefing           \x1b[0m \x1b[36mmodel\x1b[0m=\x1b[35mopenai/gpt-3.5-turbo\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.288768Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mBriefing generated successfully\x1b[0m \x1b[36mlength\x1b[0m=\x1b[35m1271\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.288768Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_STARTED             \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.289272Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4dd UPDATING_EXISTING_QUERY_RECORD\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.289272Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4ca DB_SAVE_EXECUTION_REPORT    \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.289272Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f465 DB_SAVE_LEADS_STARTED       \x1b[0m \x1b[36mlead_count\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.290473Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f504 DB_TRANSACTION_COMMIT_STARTED\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.290473Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 DB_TRANSACTION_COMMIT_COMPLETED\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.290473Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_COMPLETED_SUCCESSFULLY\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.290473Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRecruiter query processing completed\x1b[0m \x1b[36mleads_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mprocessing_time\x1b[0m=\x1b[35m7.175631\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.290473Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 JOB_COMPLETED_SUCCESSFULLY  \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:19:51.296128Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:51.297153Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mParsed JSON input             \x1b[0m \x1b[36mcontent_type\x1b[0m=\x1b[35mapplication/json\x1b[0m\n\x1b[2m2026-02-01T13:19:51.297153Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mInput normalized successfully \x1b[0m \x1b[36mhas_recruiter_id\x1b[0m=\x1b[35mTrue\x1b[0m \x1b[36mquery_length\x1b[0m=\x1b[35m28\x1b[0m\n\x1b[2m2026-02-01T13:19:51.298453Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob created and queued for processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-3\x1b[0m\n\x1b[2m2026-02-01T13:19:51.298453Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m0.002\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m200\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:51.298453Z\x1b[0m [\x1b[33m\x1b[1mwarning  \x1b[0m] \x1b[1m\u26a0\ufe0f JOB_ALREADY_IN_PROCESSING  \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m \x1b[36mstatus\x1b[0m=\x1b[35mprocessing\x1b[0m\n\x1b[2m2026-02-01T13:19:51.298453Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f680 JOB_STARTED                 \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mmax_attempts\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:51.298453Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting recruiter query processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-3\x1b[0m\n\x1b[2m2026-02-01T13:19:51.299979Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 1: Intelligence Engine   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:51.299979Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 2: Search & Ranking Orchestration\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:51.299979Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting Search Orchestration \x1b[0m \x1b[36mmode\x1b[0m=\x1b[35mdev\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 3\x1b[0m\n\x1b[2m2026-02-01T13:19:51.299979Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mQuery parsed: Find Python developers job 3, Role: find python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:51.299979Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching from JobAPIManager: Find Python developers job 3\x1b[0m\n\x1b[2m2026-02-01T13:19:51.299979Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRealTimeWebScraper: Searching for 'Find Python developers job 3'\x1b[0m\n\x1b[2m2026-02-01T13:19:51.604021Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching Arbeitnow jobs       \x1b[0m \x1b[36mparams\x1b[0m=\x1b[35m{'search': 'find python developers', 'location': 'remote', 'limit': 2}\x1b[0m\n\x1b[2m2026-02-01T13:19:51.604021Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35marbeitnow\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://www.arbeitnow.com/api/job-board-api\x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.0\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mFalse\x1b[0m\n\x1b[2m2026-02-01T13:19:51.604021Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mArbeitnow API call failed     \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m\n\x1b[2m2026-02-01T13:19:51.605871Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching RemoteOK jobs        \x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mfind python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:51.789669Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35mremoteok\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://remoteok.com/api\x1b[0m \x1b[36mjobs_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.1880000000091968\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mTrue\x1b[0m\n\x1b[2m2026-02-01T13:19:51.789669Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob search completed          \x1b[0m \x1b[36mapis_called\x1b[0m=\x1b[35m2\x1b[0m \x1b[36mtotal_jobs\x1b[0m=\x1b[35m3\x1b[0m \x1b[36munique_jobs\x1b[0m=\x1b[35m3\x1b[0m\n\x1b[2m2026-02-01T13:19:55.606418Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mRealTimeWebScraper failed: \x1b[0m\n\x1b[2m2026-02-01T13:19:55.606994Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetched 3 raw leads           \x1b[0m \x1b[36mtelemetry\x1b[0m=\x1b[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 489.69, 'leads_found': 3}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4307.02, 'leads_found': 0}}\x1b[0m\n\x1b[2m2026-02-01T13:19:55.606994Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mScoring distribution          \x1b[0m \x1b[36mmax\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmean\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmin\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mstd_dev\x1b[0m=\x1b[35m0.0\x1b[0m\n\x1b[2m2026-02-01T13:19:55.606994Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mDeduplication & Density Check complete\x1b[0m \x1b[36mfinal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36moriginal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36msemantic_duplicates\x1b[0m=\x1b[35m0\x1b[0m\n\x1b[2m2026-02-01T13:19:55.606994Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mEnriched 3 leads with intelligence data\x1b[0m\n\x1b[2m2026-02-01T13:19:55.606994Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 3: Generating synthesis report\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:55.606994Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGenerating briefing           \x1b[0m \x1b[36mmodel\x1b[0m=\x1b[35mopenai/gpt-3.5-turbo\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.814291Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mBriefing generated successfully\x1b[0m \x1b[36mlength\x1b[0m=\x1b[35m961\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.814291Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_STARTED             \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.815383Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4dd UPDATING_EXISTING_QUERY_RECORD\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.815383Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4ca DB_SAVE_EXECUTION_REPORT    \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.815383Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f465 DB_SAVE_LEADS_STARTED       \x1b[0m \x1b[36mlead_count\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.815383Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f504 DB_TRANSACTION_COMMIT_STARTED\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.815383Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 DB_TRANSACTION_COMMIT_COMPLETED\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.815383Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_COMPLETED_SUCCESSFULLY\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.815383Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRecruiter query processing completed\x1b[0m \x1b[36mleads_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mprocessing_time\x1b[0m=\x1b[35m6.515838\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.815383Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 JOB_COMPLETED_SUCCESSFULLY  \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:19:57.818463Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:57.822872Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mParsed JSON input             \x1b[0m \x1b[36mcontent_type\x1b[0m=\x1b[35mapplication/json\x1b[0m\n\x1b[2m2026-02-01T13:19:57.822872Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mInput normalized successfully \x1b[0m \x1b[36mhas_recruiter_id\x1b[0m=\x1b[35mTrue\x1b[0m \x1b[36mquery_length\x1b[0m=\x1b[35m28\x1b[0m\n\x1b[2m2026-02-01T13:19:57.822872Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob created and queued for processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 4\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-4\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824392Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m0.006\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m200\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824913Z\x1b[0m [\x1b[33m\x1b[1mwarning  \x1b[0m] \x1b[1m\u26a0\ufe0f JOB_ALREADY_IN_PROCESSING  \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m \x1b[36mstatus\x1b[0m=\x1b[35mprocessing\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824913Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f680 JOB_STARTED                 \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mmax_attempts\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824913Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting recruiter query processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 4\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mtest-user-4\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824913Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 1: Intelligence Engine   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824913Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 2: Search & Ranking Orchestration\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824913Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting Search Orchestration \x1b[0m \x1b[36mmode\x1b[0m=\x1b[35mdev\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mFind Python developers job 4\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824913Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mQuery parsed: Find Python developers job 4, Role: find python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824913Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching from JobAPIManager: Find Python developers job 4\x1b[0m\n\x1b[2m2026-02-01T13:19:57.824913Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRealTimeWebScraper: Searching for 'Find Python developers job 4'\x1b[0m\n\x1b[2m2026-02-01T13:19:58.137780Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching Arbeitnow jobs       \x1b[0m \x1b[36mparams\x1b[0m=\x1b[35m{'search': 'find python developers', 'location': 'remote', 'limit': 2}\x1b[0m\n\x1b[2m2026-02-01T13:19:58.137780Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35marbeitnow\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://www.arbeitnow.com/api/job-board-api\x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.0\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mFalse\x1b[0m\n\x1b[2m2026-02-01T13:19:58.137780Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mArbeitnow API call failed     \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m\n\x1b[2m2026-02-01T13:19:58.137780Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching RemoteOK jobs        \x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mfind python developers\x1b[0m\n\x1b[2m2026-02-01T13:19:58.321299Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35mremoteok\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://remoteok.com/api\x1b[0m \x1b[36mjobs_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.1870000000053551\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mTrue\x1b[0m\n\x1b[2m2026-02-01T13:19:58.321299Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob search completed          \x1b[0m \x1b[36mapis_called\x1b[0m=\x1b[35m2\x1b[0m \x1b[36mtotal_jobs\x1b[0m=\x1b[35m3\x1b[0m \x1b[36munique_jobs\x1b[0m=\x1b[35m3\x1b[0m\n\x1b[2m2026-02-01T13:20:02.131606Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mRealTimeWebScraper failed: \x1b[0m\n\x1b[2m2026-02-01T13:20:02.131606Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetched 3 raw leads           \x1b[0m \x1b[36mtelemetry\x1b[0m=\x1b[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 496.39, 'leads_found': 3}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4306.69, 'leads_found': 0}}\x1b[0m\n\x1b[2m2026-02-01T13:20:02.131606Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mScoring distribution          \x1b[0m \x1b[36mmax\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmean\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmin\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mstd_dev\x1b[0m=\x1b[35m0.0\x1b[0m\n\x1b[2m2026-02-01T13:20:02.131606Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mDeduplication & Density Check complete\x1b[0m \x1b[36mfinal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36moriginal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36msemantic_duplicates\x1b[0m=\x1b[35m0\x1b[0m\n\x1b[2m2026-02-01T13:20:02.131606Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mEnriched 3 leads with intelligence data\x1b[0m\n\x1b[2m2026-02-01T13:20:02.131606Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 3: Generating synthesis report\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:02.131606Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGenerating briefing           \x1b[0m \x1b[36mmodel\x1b[0m=\x1b[35mopenai/gpt-3.5-turbo\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mBriefing generated successfully\x1b[0m \x1b[36mlength\x1b[0m=\x1b[35m1235\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_STARTED             \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4dd UPDATING_EXISTING_QUERY_RECORD\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4ca DB_SAVE_EXECUTION_REPORT    \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f465 DB_SAVE_LEADS_STARTED       \x1b[0m \x1b[36mlead_count\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f504 DB_TRANSACTION_COMMIT_STARTED\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 DB_TRANSACTION_COMMIT_COMPLETED\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_COMPLETED_SUCCESSFULLY\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRecruiter query processing completed\x1b[0m \x1b[36mleads_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mprocessing_time\x1b[0m=\x1b[35m7.073714\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:04.898627Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 JOB_COMPLETED_SUCCESSFULLY  \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\nSubmitted jobs: ['9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f', 'e2226bc4-d9a0-4f3e-9192-a4d122e8806c', '92bfe21c-c479-40f4-9587-4a0de73be42b', '803cfd63-278f-4b05-8647-ce331d74badf', 'e6ed3b4d-a0e4-43f1-9f52-aaeb56060e24']\nWaiting for all jobs to complete...\n\x1b[2m2026-02-01T13:20:04.901140Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:20:04.905050Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGetting query status          \x1b[0m \x1b[36midentity\x1b[0m=\x1b[35manonymous\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:20:04.905050Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline get_query_status called\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:20:12.122849Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery status retrieval failed \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mError 11001 connecting to mock-redis:6379. 11001.\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:20:12.122849Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline result               \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m \x1b[36mresult\x1b[0m=\x1b[35mNone\x1b[0m\n\x1b[2m2026-02-01T13:20:12.122849Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery not found in pipeline   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:20:12.124081Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m7.223\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m404\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/9ff8ab15-eee3-41c1-9bb9-89bfa5bc1a5f\x1b[0m\n\x1b[2m2026-02-01T13:20:12.128069Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/e2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:20:12.131168Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGetting query status          \x1b[0m \x1b[36midentity\x1b[0m=\x1b[35manonymous\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:20:12.132250Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline get_query_status called\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:20:14.816999Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery status retrieval failed \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mError 11001 connecting to mock-redis:6379. 11001.\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:20:14.816999Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline result               \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m \x1b[36mresult\x1b[0m=\x1b[35mNone\x1b[0m\n\x1b[2m2026-02-01T13:20:14.816999Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery not found in pipeline   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:20:14.816999Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m2.689\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m404\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/e2226bc4-d9a0-4f3e-9192-a4d122e8806c\x1b[0m\n\x1b[2m2026-02-01T13:20:14.820984Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:20:14.822518Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGetting query status          \x1b[0m \x1b[36midentity\x1b[0m=\x1b[35manonymous\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:20:14.822518Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline get_query_status called\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:20:17.094925Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery status retrieval failed \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mError 11001 connecting to mock-redis:6379. 11001.\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:20:17.096013Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline result               \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m \x1b[36mresult\x1b[0m=\x1b[35mNone\x1b[0m\n\x1b[2m2026-02-01T13:20:17.096013Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery not found in pipeline   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:20:17.096013Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m2.275\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m404\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/92bfe21c-c479-40f4-9587-4a0de73be42b\x1b[0m\n\x1b[2m2026-02-01T13:20:17.100537Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:20:17.100537Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGetting query status          \x1b[0m \x1b[36midentity\x1b[0m=\x1b[35manonymous\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:20:17.101772Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline get_query_status called\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:20:19.372198Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery status retrieval failed \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mError 11001 connecting to mock-redis:6379. 11001.\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:20:19.372198Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline result               \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m \x1b[36mresult\x1b[0m=\x1b[35mNone\x1b[0m\n\x1b[2m2026-02-01T13:20:19.372198Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery not found in pipeline   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:20:19.373835Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m2.272\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m404\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/803cfd63-278f-4b05-8647-ce331d74badf\x1b[0m\n\x1b[2m2026-02-01T13:20:19.376929Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/e6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:19.377933Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGetting query status          \x1b[0m \x1b[36midentity\x1b[0m=\x1b[35manonymous\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:19.377933Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline get_query_status called\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:21.644928Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery status retrieval failed \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mError 11001 connecting to mock-redis:6379. 11001.\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:21.644928Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline result               \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m \x1b[36mresult\x1b[0m=\x1b[35mNone\x1b[0m\n\x1b[2m2026-02-01T13:20:21.644928Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery not found in pipeline   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35me6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m\n\x1b[2m2026-02-01T13:20:21.644928Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m2.268\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m404\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/e6ed3b4d-a0e4-43f1-9f52-aaeb56060e24\x1b[0m
_________________________ test_job_recovery_mechanism _________________________

    @pytest.mark.asyncio
    async def test_job_recovery_mechanism():
        """Test zombie job recovery on startup."""
        import time
        from unittest.mock import patch, AsyncMock
    
        # Create a job and manually set it to processing (simulating a stuck job)
        client = TestClient(app)
    
        response = client.post("/api/recruiter/query", json={
            "query": "Test recovery job",
            "recruiter_id": "recovery-test"
        })
        assert response.status_code == 200
        job_data = response.json()
        job_id = job_data["query_id"]
    
        # Manually update the job to be "old" (simulating it got stuck)
        from app.database import SessionLocal, Query
        from datetime import datetime, timedelta
    
        db_session = SessionLocal()
        try:
            # Make the job appear 10 minutes old
            old_timestamp = datetime.utcnow() - timedelta(minutes=10)
            job = db_session.query(Query).filter(Query.id == job_id).first()
            if job:
                job.created_at = old_timestamp
                # Ensure it's still in processing state
                job.processing_status = "processing"
                db_session.commit()
    
            db_session.close()
    
            # Trigger recovery mechanism
            from app.main import _recover_zombie_jobs
            await _recover_zombie_jobs()
    
            # Verify job was marked as failed
            db_session = SessionLocal()
            recovered_job = db_session.query(Query).filter(Query.id == job_id).first()
            db_session.close()
    
>           assert recovered_job is not None
E           assert None is not None

tests\test_api.py:424: AssertionError
---------------------------- Captured stdout call -----------------------------
\x1b[2m2026-02-01T13:20:21.671336Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:20:21.671336Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mParsed JSON input             \x1b[0m \x1b[36mcontent_type\x1b[0m=\x1b[35mapplication/json\x1b[0m\n\x1b[2m2026-02-01T13:20:21.671336Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mInput normalized successfully \x1b[0m \x1b[36mhas_recruiter_id\x1b[0m=\x1b[35mTrue\x1b[0m \x1b[36mquery_length\x1b[0m=\x1b[35m17\x1b[0m\n\x1b[2m2026-02-01T13:20:21.675528Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting recruiter query processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mTest recovery job\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mrecovery-test\x1b[0m\n\x1b[2m2026-02-01T13:20:21.675528Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 1: Intelligence Engine   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:21.675528Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 2: Search & Ranking Orchestration\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:21.675528Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting Search Orchestration \x1b[0m \x1b[36mmode\x1b[0m=\x1b[35mdev\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mTest recovery job\x1b[0m\n\x1b[2m2026-02-01T13:20:21.675528Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mQuery parsed: Test recovery job, Role: test recovery job\x1b[0m\n\x1b[2m2026-02-01T13:20:21.675528Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching from JobAPIManager: Test recovery job\x1b[0m\n\x1b[2m2026-02-01T13:20:21.675528Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRealTimeWebScraper: Searching for 'Test recovery job'\x1b[0m\n\x1b[2m2026-02-01T13:20:21.989424Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching Arbeitnow jobs       \x1b[0m \x1b[36mparams\x1b[0m=\x1b[35m{'search': 'test recovery job', 'location': 'remote', 'limit': 2}\x1b[0m\n\x1b[2m2026-02-01T13:20:21.993038Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35marbeitnow\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://www.arbeitnow.com/api/job-board-api\x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.0\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mFalse\x1b[0m\n\x1b[2m2026-02-01T13:20:21.993038Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mArbeitnow API call failed     \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m\n\x1b[2m2026-02-01T13:20:21.993038Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching RemoteOK jobs        \x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mtest recovery job\x1b[0m\n\x1b[2m2026-02-01T13:20:22.257821Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35mremoteok\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://remoteok.com/api\x1b[0m \x1b[36mjobs_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.26600000000325963\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mTrue\x1b[0m\n\x1b[2m2026-02-01T13:20:22.257821Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob search completed          \x1b[0m \x1b[36mapis_called\x1b[0m=\x1b[35m2\x1b[0m \x1b[36mtotal_jobs\x1b[0m=\x1b[35m3\x1b[0m \x1b[36munique_jobs\x1b[0m=\x1b[35m3\x1b[0m\n\x1b[2m2026-02-01T13:20:25.994160Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mRealTimeWebScraper failed: \x1b[0m\n\x1b[2m2026-02-01T13:20:25.994160Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetched 3 raw leads           \x1b[0m \x1b[36mtelemetry\x1b[0m=\x1b[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 582.29, 'leads_found': 3}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4318.63, 'leads_found': 0}}\x1b[0m\n\x1b[2m2026-02-01T13:20:25.994160Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mScoring distribution          \x1b[0m \x1b[36mmax\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmean\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mmin\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mstd_dev\x1b[0m=\x1b[35m0.0\x1b[0m\n\x1b[2m2026-02-01T13:20:25.994160Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mDeduplication & Density Check complete\x1b[0m \x1b[36mfinal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36moriginal\x1b[0m=\x1b[35m3\x1b[0m \x1b[36msemantic_duplicates\x1b[0m=\x1b[35m0\x1b[0m\n\x1b[2m2026-02-01T13:20:25.994160Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mEnriched 3 leads with intelligence data\x1b[0m\n\x1b[2m2026-02-01T13:20:25.994160Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 3: Generating synthesis report\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:25.994160Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGenerating briefing           \x1b[0m \x1b[36mmodel\x1b[0m=\x1b[35mopenai/gpt-3.5-turbo\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.507594Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mBriefing generated successfully\x1b[0m \x1b[36mlength\x1b[0m=\x1b[35m1366\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.507594Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_STARTED             \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.509609Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4dd UPDATING_EXISTING_QUERY_RECORD\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.509609Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4ca DB_SAVE_EXECUTION_REPORT    \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.509609Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f465 DB_SAVE_LEADS_STARTED       \x1b[0m \x1b[36mlead_count\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.510612Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f504 DB_TRANSACTION_COMMIT_STARTED\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.510612Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 DB_TRANSACTION_COMMIT_COMPLETED\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.511026Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_COMPLETED_SUCCESSFULLY\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.511026Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRecruiter query processing completed\x1b[0m \x1b[36mleads_found\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mprocessing_time\x1b[0m=\x1b[35m11.832066\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m0a72e5cf-86d9-42ba-aa66-29d9a3b3e82b\x1b[0m\n\x1b[2m2026-02-01T13:20:33.511026Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m11.84\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m200\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:20:33.515665Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f50d STARTING_ZOMBIE_JOB_RECOVERY\x1b[0m\n\x1b[2m2026-02-01T13:20:33.516669Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 NO_ZOMBIE_JOBS_FOUND\x1b[0m
_________________________ test_job_timeout_mechanism __________________________

    @pytest.mark.asyncio
    async def test_job_timeout_mechanism():
        """Test that jobs timeout and get marked as failed."""
        import asyncio
    
        # Create a job that will timeout
        client = TestClient(app)
    
        # Patch the pipeline to simulate a long-running operation
        with patch('app.services.pipeline.RecruiterPipeline.process_recruiter_query', new_callable=AsyncMock) as mock_pipeline:
            # Make the pipeline take longer than the timeout
            async def slow_pipeline(*args, **kwargs):
                await asyncio.sleep(10)  # Sleep longer than timeout
                return {"status": "completed"}
    
            mock_pipeline.side_effect = slow_pipeline
    
            # Submit job
            response = client.post("/api/recruiter/query", json={
                "query": "Test timeout job",
                "recruiter_id": "timeout-test"
            })
>           assert response.status_code == 200
E           assert 500 == 200
E            +  where 500 = <Response [500 Internal Server Error]>.status_code

tests\test_api.py:456: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:20:33.544339Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mPOST[0m [36murl[0m=[35mhttp://testserver/api/recruiter/query[0m
[2m2026-02-01T13:20:33.549100Z[0m [[32m[1minfo     [0m] [1mParsed JSON input             [0m [36mcontent_type[0m=[35mapplication/json[0m
[2m2026-02-01T13:20:33.549887Z[0m [[32m[1minfo     [0m] [1mInput normalized successfully [0m [36mhas_recruiter_id[0m=[35mTrue[0m [36mquery_length[0m=[35m16[0m
[2m2026-02-01T13:20:43.560222Z[0m [[31m[1merror    [0m] [1mQuery processing failed       [0m [36merror[0m=[35m2 validation errors for QueryResponse
query_id
  Field required [type=missing, input_value={'status': 'completed'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/missing
original_query
  Field required [type=missing, input_value={'status': 'completed'}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.5/v/missing[0m [36mquery[0m=[35mTest timeout job[0m
[2m2026-02-01T13:20:43.560222Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mPOST[0m [36mprocess_time[0m=[35m10.016[0m [36mstatus_code[0m=[35m500[0m [36murl[0m=[35mhttp://testserver/api/recruiter/query[0m
_________________ TestCLICommands.test_query_command_success __________________

self = <tests.test_cli.TestCLICommands object at 0x00000286DF9CEB40>
mock_client_class = <MagicMock name='APIClient' id='2778311482816'>
runner = <typer.testing.CliRunner object at 0x00000286E03B9340>

    @patch('tools.recruiter_cli.APIClient')
    def test_query_command_success(self, mock_client_class, runner):
        """Test query command with successful submission."""
        mock_client = Mock()
        mock_client.submit_query.return_value = {
            "query_id": "test-123",
            "status": "processing",
            "original_query": "Find Python developers"
        }
        mock_client_class.return_value = mock_client
    
        result = runner.invoke(app, ["query", "Find Python developers", "--recruiter", "1"])
    
>       assert result.exit_code == 0
E       AssertionError: assert 1 == 0
E        +  where 1 = <Result TypeError('TyperArgument.make_metavar() takes 1 positional argument but 2 were given')>.exit_code

tests\test_cli.py:158: AssertionError
________________ TestCLICommands.test_query_command_with_wait _________________

self = <tests.test_cli.TestCLICommands object at 0x00000286DF9CFE30>
mock_client_class = <MagicMock name='APIClient' id='2778310329552'>
runner = <typer.testing.CliRunner object at 0x00000286E03365D0>

    @patch('tools.recruiter_cli.APIClient')
    def test_query_command_with_wait(self, mock_client_class, runner):
        """Test query command with wait option."""
        mock_client = Mock()
        # First call returns processing, second returns completed
        mock_client.submit_query.return_value = {
            "query_id": "test-123",
            "status": "processing",
            "original_query": "Find Python developers"
        }
        mock_client.get_query_status.side_effect = [
            {"query_id": "test-123", "status": "processing"},
            {"query_id": "test-123", "status": "completed", "total_leads_found": 3, "leads": []}
        ]
        mock_client_class.return_value = mock_client
    
        result = runner.invoke(app, ["query", "Find Python developers", "--wait"])
    
        assert result.exit_code == 0
>       assert "Query completed" in result.output
E       assert 'Query completed' in 'Query submitted successfully!\nQuery ID: test-123\nStatus: processing\n{\n  "query_id": "test-123",\n  "status": "processing",\n  "original_query": "Find Python developers"\n}\n'
E        +  where 'Query submitted successfully!\nQuery ID: test-123\nStatus: processing\n{\n  "query_id": "test-123",\n  "status": "processing",\n  "original_query": "Find Python developers"\n}\n' = <Result okay>.output

tests\test_cli.py:181: AssertionError
______________ TestCLICommands.test_results_command_json_output _______________

self = <tests.test_cli.TestCLICommands object at 0x00000286DF9E0920>
mock_client_class = <MagicMock name='APIClient' id='2778311165376'>
runner = <typer.testing.CliRunner object at 0x00000286E0403CE0>

    @patch('tools.recruiter_cli.APIClient')
    def test_results_command_json_output(self, mock_client_class, runner):
        """Test results command with JSON output."""
        mock_client = Mock()
        expected_result = {
            "query_id": "test-123",
            "status": "completed",
            "total_leads_found": 1
        }
        mock_client.get_query_status.return_value = expected_result
        mock_client_class.return_value = mock_client
    
        result = runner.invoke(app, ["results", "test-123", "--json"])
    
        assert result.exit_code == 0
        # Should contain JSON output
>       assert "test-123" in result.output
E       AssertionError: assert 'test-123' in '\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n\u2502 Query: N/A        \u2502\\n\u2502 Status: completed \u2502\\n\u2502 .2fTotal Leads: 1 \u2502\\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\nNo leads found.\\n'
E        +  where '\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\\n\u2502 Query: N/A        \u2502\\n\u2502 Status: completed \u2502\\n\u2502 .2fTotal Leads: 1 \u2502\\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\\nNo leads found.\\n' = <Result okay>.output

tests\test_cli.py:247: AssertionError
_____________________ test_deduplication_metrics_present ______________________

    @pytest.mark.asyncio
    async def test_deduplication_metrics_present():
        """Verify deduplication metrics are included in response."""
        query = "software engineer"
    
        intel_result = await IntelligenceEngine.process(query)
    
        intelligence_envelope = {
            "intelligence": {
                "role": intel_result.role,
                "seniority": intel_result.seniority,
                "location": intel_result.location,
                "skills": intel_result.skills
            },
            "signals": {
                "hiring_pressure": intel_result.hiring_pressure,
                "role_scarcity": intel_result.role_scarcity,
                "market_difficulty": intel_result.market_difficulty,
                "outsourcing_likelihood": intel_result.outsourcing_likelihood
            }
        }
    
        orchestrator = SearchOrchestrator()
        result = await orchestrator.orchestrate(query, intelligence_envelope)
    
        metrics = result["metrics"]
    
        # Required metrics
>       assert "raw_leads_fetched" in metrics
E       AssertionError: assert 'raw_leads_fetched' in {'deduplicated_count': 19, 'execution_mode': 'dev', 'execution_time_ms': 4326.19, 'leads_saved': 0, ...}

tests\test_contract_validation.py:146: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:21:25.534736Z[0m [[32m[1minfo     [0m] [1mPublic APIs ENABLED           [0m [36marbeitnow[0m=[35mTrue[0m [36mgithub[0m=[35mFalse[0m
[2m2026-02-01T13:21:25.534736Z[0m [[32m[1minfo     [0m] [1mReal-Time Web Scraper ENABLED (DuckDuckGo/LinkedIn/Indeed)[0m
[2m2026-02-01T13:21:25.534736Z[0m [[32m[1minfo     [0m] [1mMock Data Sources ENABLED[0m
[2m2026-02-01T13:21:25.534736Z[0m [[32m[1minfo     [0m] [1mSearchOrchestrator initialized with 3 providers[0m [36mproviders[0m=[35m['MockJobBoard', 'RealTimeWebScraper', 'MockCompanyAPI'][0m
[2m2026-02-01T13:21:25.534736Z[0m [[32m[1minfo     [0m] [1mStarting Search Orchestration [0m [36mmode[0m=[35mdev[0m [36mquery[0m=[35msoftware engineer[0m
[2m2026-02-01T13:21:25.534736Z[0m [[32m[1minfo     [0m] [1mQuery parsed: software engineer, Role: software engineer[0m
[2m2026-02-01T13:21:25.534736Z[0m [[32m[1minfo     [0m] [1mFetching from JobAPIManager: software engineer[0m
[2m2026-02-01T13:21:25.535792Z[0m [[32m[1minfo     [0m] [1mRealTimeWebScraper: Searching for 'software engineer'[0m
[2m2026-02-01T13:21:25.853762Z[0m [[32m[1minfo     [0m] [1mFetching Arbeitnow jobs       [0m [36mparams[0m=[35m{'search': 'software engineer', 'location': 'remote', 'limit': 2}[0m
[2m2026-02-01T13:21:25.853762Z[0m [[32m[1minfo     [0m] [1mFetching RemoteOK jobs        [0m [36mquery[0m=[35msoftware engineer[0m
[2m2026-02-01T13:21:25.855415Z[0m [[32m[1minfo     [0m] [1mapi_call                      [0m [36mapi[0m=[35mremoteok[0m [36mendpoint[0m=[35mhttps://remoteok.com/api[0m [36merror[0m=[35mEvent loop is closed[0m [36mlatency[0m=[35m0.0[0m [36msuccess[0m=[35mFalse[0m
[2m2026-02-01T13:21:25.855415Z[0m [[31m[1merror    [0m] [1mRemoteOK API call failed      [0m [36merror[0m=[35mEvent loop is closed[0m
[2m2026-02-01T13:21:26.351817Z[0m [[32m[1minfo     [0m] [1mapi_call                      [0m [36mapi[0m=[35marbeitnow[0m [36mendpoint[0m=[35mhttps://www.arbeitnow.com/api/job-board-api[0m [36mjobs_found[0m=[35m100[0m [36mlatency[0m=[35m0.5[0m [36msuccess[0m=[35mTrue[0m
[2m2026-02-01T13:21:26.351817Z[0m [[32m[1minfo     [0m] [1mJob search completed          [0m [36mapis_called[0m=[35m2[0m [36mtotal_jobs[0m=[35m100[0m [36munique_jobs[0m=[35m100[0m
[2m2026-02-01T13:21:29.855095Z[0m [[31m[1merror    [0m] [1mRealTimeWebScraper failed: [0m
[2m2026-02-01T13:21:29.855095Z[0m [[32m[1minfo     [0m] [1mFetched 100 raw leads         [0m [36mtelemetry[0m=[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 817.08, 'leads_found': 100}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4319.3, 'leads_found': 0}}[0m
[2m2026-02-01T13:21:29.859922Z[0m [[32m[1minfo     [0m] [1mScoring distribution          [0m [36mmax[0m=[35m57.8[0m [36mmean[0m=[35m40.178[0m [36mmin[0m=[35m40.0[0m [36mstd_dev[0m=[35m1.7799999999999998[0m
[2m2026-02-01T13:21:29.859922Z[0m [[32m[1minfo     [0m] [1mDeduplication & Density Check complete[0m [36mfinal[0m=[35m81[0m [36moriginal[0m=[35m100[0m [36msemantic_duplicates[0m=[35m0[0m
[2m2026-02-01T13:21:29.860922Z[0m [[32m[1minfo     [0m] [1mEnriched 81 leads with intelligence data[0m
_______________________ test_job_structure_determinism ________________________

    @pytest.mark.asyncio
    async def test_job_structure_determinism():
        """Verify that processing a query yields populated concept inputs deterministically."""
        pipeline = RecruiterPipeline()
        await pipeline.initialize()
    
        # Mock orchestrator
        mock_orch = AsyncMock()
        mock_orch.orchestrate_search.return_value = {
            "confidence": 0.9,
            "total_steps": 1,
            "total_cost": 0,
            "evidence_objects": [{"title": "Dev"}]
        }
        pipeline.action_orchestrator = mock_orch
    
        # Mock judge
        mock_judge = AsyncMock()
        mock_judge.judge_leads.return_value = [{"company": "TestCo", "score": 95, "confidence": 0.9, "reasons": [], "evidence_count": 1}]
        pipeline.signal_judge = mock_judge
    
        # Mock DB save
        pipeline._save_to_database = AsyncMock()
    
        query = "Find senior AI engineers in Bangalore"
    
        # Run 1
        result1 = await pipeline.process_recruiter_query(query)
        assert result1["status"] == "completed"
        assert "hiring_pressure" in result1["concept_vector"]
>       assert result1["constraints"]["role"] == "AI Engineer"
E       AssertionError: assert 'find senior ai' == 'AI Engineer'
E         
E         - AI Engineer
E         + find senior ai

tests\test_critical_hardening.py:89: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:21:42.925766Z[0m [[32m[1minfo     [0m] [1mRecruiter pipeline initialized and verified[0m
[2m2026-02-01T13:21:42.925766Z[0m [[32m[1minfo     [0m] [1mStarting recruiter query processing[0m [36mquery[0m=[35mFind senior AI engineers in Bangalore[0m [36mquery_id[0m=[35m0625ee6f-11de-454a-bdbe-74419ed8bcb3[0m [36mrecruiter_id[0m=[35mNone[0m
[2m2026-02-01T13:21:42.927245Z[0m [[32m[1minfo     [0m] [1mStep 1: Intelligence Engine   [0m [36mquery_id[0m=[35m0625ee6f-11de-454a-bdbe-74419ed8bcb3[0m
[2m2026-02-01T13:21:42.927245Z[0m [[32m[1minfo     [0m] [1mStep 2: Search & Ranking Orchestration[0m [36mquery_id[0m=[35m0625ee6f-11de-454a-bdbe-74419ed8bcb3[0m
[2m2026-02-01T13:21:42.927245Z[0m [[32m[1minfo     [0m] [1mStarting Search Orchestration [0m [36mmode[0m=[35mdev[0m [36mquery[0m=[35mFind senior AI engineers in Bangalore[0m
[2m2026-02-01T13:21:42.927245Z[0m [[32m[1minfo     [0m] [1mQuery parsed: Find senior AI engineers in Bangalore, Role: find senior ai[0m
[2m2026-02-01T13:21:42.927245Z[0m [[32m[1minfo     [0m] [1mFetching from JobAPIManager: Find senior AI engineers in Bangalore[0m
[2m2026-02-01T13:21:42.927245Z[0m [[32m[1minfo     [0m] [1mRealTimeWebScraper: Searching for 'Find senior AI engineers in Bangalore'[0m
[2m2026-02-01T13:21:43.242577Z[0m [[32m[1minfo     [0m] [1mFetching Arbeitnow jobs       [0m [36mparams[0m=[35m{'search': 'find senior ai', 'location': 'remote', 'limit': 2}[0m
[2m2026-02-01T13:21:43.242577Z[0m [[32m[1minfo     [0m] [1mFetching RemoteOK jobs        [0m [36mquery[0m=[35mfind senior ai[0m
[2m2026-02-01T13:21:43.242577Z[0m [[32m[1minfo     [0m] [1mapi_call                      [0m [36mapi[0m=[35mremoteok[0m [36mendpoint[0m=[35mhttps://remoteok.com/api[0m [36merror[0m=[35mEvent loop is closed[0m [36mlatency[0m=[35m0.0[0m [36msuccess[0m=[35mFalse[0m
[2m2026-02-01T13:21:43.242577Z[0m [[31m[1merror    [0m] [1mRemoteOK API call failed      [0m [36merror[0m=[35mEvent loop is closed[0m
[2m2026-02-01T13:21:43.392386Z[0m [[32m[1minfo     [0m] [1mapi_call                      [0m [36mapi[0m=[35marbeitnow[0m [36mendpoint[0m=[35mhttps://www.arbeitnow.com/api/job-board-api[0m [36mjobs_found[0m=[35m100[0m [36mlatency[0m=[35m0.14100000000325963[0m [36msuccess[0m=[35mTrue[0m
[2m2026-02-01T13:21:43.392386Z[0m [[32m[1minfo     [0m] [1mJob search completed          [0m [36mapis_called[0m=[35m2[0m [36mtotal_jobs[0m=[35m100[0m [36munique_jobs[0m=[35m100[0m
[2m2026-02-01T13:21:47.253704Z[0m [[31m[1merror    [0m] [1mRealTimeWebScraper failed: [0m
[2m2026-02-01T13:21:47.253704Z[0m [[32m[1minfo     [0m] [1mFetched 100 raw leads         [0m [36mtelemetry[0m=[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 465.14, 'leads_found': 100}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4326.46, 'leads_found': 0}}[0m
[2m2026-02-01T13:21:47.257582Z[0m [[32m[1minfo     [0m] [1mScoring distribution          [0m [36mmax[0m=[35m59.4[0m [36mmean[0m=[35m40.194[0m [36mmin[0m=[35m40.0[0m [36mstd_dev[0m=[35m1.94[0m
[2m2026-02-01T13:21:47.257582Z[0m [[32m[1minfo     [0m] [1mDeduplication & Density Check complete[0m [36mfinal[0m=[35m81[0m [36moriginal[0m=[35m100[0m [36msemantic_duplicates[0m=[35m0[0m
[2m2026-02-01T13:21:47.257582Z[0m [[32m[1minfo     [0m] [1mEnriched 81 leads with intelligence data[0m
[2m2026-02-01T13:21:47.257582Z[0m [[32m[1minfo     [0m] [1mStep 3: Generating synthesis report[0m [36mquery_id[0m=[35m0625ee6f-11de-454a-bdbe-74419ed8bcb3[0m
[2m2026-02-01T13:21:47.257582Z[0m [[32m[1minfo     [0m] [1mGenerating briefing           [0m [36mmodel[0m=[35mopenai/gpt-3.5-turbo[0m [36mquery_id[0m=[35m0625ee6f-11de-454a-bdbe-74419ed8bcb3[0m
[2m2026-02-01T13:21:50.158976Z[0m [[32m[1minfo     [0m] [1mBriefing generated successfully[0m [36mlength[0m=[35m1372[0m [36mquery_id[0m=[35m0625ee6f-11de-454a-bdbe-74419ed8bcb3[0m
[2m2026-02-01T13:21:50.160496Z[0m [[32m[1minfo     [0m] [1mRecruiter query processing completed[0m [36mleads_found[0m=[35m81[0m [36mprocessing_time[0m=[35m7.23321[0m [36mquery_id[0m=[35m0625ee6f-11de-454a-bdbe-74419ed8bcb3[0m
___________________ test_deduplication_skips_empty_company ____________________

    def test_deduplication_skips_empty_company():
        """Verify leads with empty company names are skipped."""
        leads = [
            NormalizedLead(
                company_name="",  # Empty company
                role="Engineer",
                location="Pune",
                job_url="http://test1.com",
                source="test",
                skills=[],
                confidence_score=85.0
            ),
            NormalizedLead(
                company_name="TechCorp",
                role="Engineer",
                location="Pune",
                job_url="http://test2.com",
                source="test",
                skills=[],
                confidence_score=90.0
            ),
        ]
    
        ranked = LeadRanker.rank(leads)
    
>       assert len(ranked) == 1
E       AssertionError: assert 2 == 1
E        +  where 2 = len([NormalizedLead(company_name='TechCorp', role='Engineer', location='Pune', job_url='http://test2.com', source='test', skills=[], salary_range=None, hiring_urgency='Unknown', company_growth_stage='Unknown', funding_stage='Unknown', confidence_score=90.0), NormalizedLead(company_name='', role='Engineer', location='Pune', job_url='http://test1.com', source='test', skills=[], salary_range=None, hiring_urgency='Unknown', company_growth_stage='Unknown', funding_stage='Unknown', confidence_score=85.0)])

tests\test_deduplication.py:240: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:12.613900Z[0m [[32m[1minfo     [0m] [1mDeduplication & Density Check complete[0m [36mfinal[0m=[35m2[0m [36moriginal[0m=[35m2[0m [36msemantic_duplicates[0m=[35m0[0m
__________________________ test_pipeline_persistence __________________________

    @pytest.mark.asyncio
    async def test_pipeline_persistence():
        """Verify end-to-end flow: Orchestrator -> Pipeline -> DB Persistence."""
        # Ensure DB tables exist (if using in-memory or test DB, usually validation script handles this)
        # Here we rely on shared test env
    
        # Run Pipeline
        result = await recruiter_pipeline.process_recruiter_query("senior python dev")
        query_id = result["query_id"]
    
        # 1. Verify API Response Contract
        assert "orchestration_summary" in result
        summary = result["orchestration_summary"]
        assert summary["raw_leads_found"] > 0
        assert summary["providers_called"] > 0
>       assert result["total_leads_found"] == summary["raw_leads_found"]
E       assert 81 == 100

tests\test_execution_reporting.py:39: AssertionError
---------------------------- Captured stdout call -----------------------------
\x1b[2m2026-02-01T13:23:16.982388Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting recruiter query processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35msenior python dev\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35mNone\x1b[0m\n\x1b[2m2026-02-01T13:23:16.982943Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 1: Intelligence Engine   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:16.982943Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 2: Search & Ranking Orchestration\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:16.982943Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting Search Orchestration \x1b[0m \x1b[36mmode\x1b[0m=\x1b[35mdev\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35msenior python dev\x1b[0m\n\x1b[2m2026-02-01T13:23:16.982943Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mQuery parsed: senior python dev, Role: senior python dev\x1b[0m\n\x1b[2m2026-02-01T13:23:16.982943Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching from JobAPIManager: senior python dev\x1b[0m\n\x1b[2m2026-02-01T13:23:16.982943Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRealTimeWebScraper: Searching for 'senior python dev'\x1b[0m\n\x1b[2m2026-02-01T13:23:17.297747Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching Arbeitnow jobs       \x1b[0m \x1b[36mparams\x1b[0m=\x1b[35m{'search': 'senior python dev', 'location': 'remote', 'limit': 2}\x1b[0m\n\x1b[2m2026-02-01T13:23:17.299259Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetching RemoteOK jobs        \x1b[0m \x1b[36mquery\x1b[0m=\x1b[35msenior python dev\x1b[0m\n\x1b[2m2026-02-01T13:23:17.301672Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35mremoteok\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://remoteok.com/api\x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.0\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mFalse\x1b[0m\n\x1b[2m2026-02-01T13:23:17.301672Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mRemoteOK API call failed      \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mEvent loop is closed\x1b[0m\n\x1b[2m2026-02-01T13:23:17.660912Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mapi_call                      \x1b[0m \x1b[36mapi\x1b[0m=\x1b[35marbeitnow\x1b[0m \x1b[36mendpoint\x1b[0m=\x1b[35mhttps://www.arbeitnow.com/api/job-board-api\x1b[0m \x1b[36mjobs_found\x1b[0m=\x1b[35m100\x1b[0m \x1b[36mlatency\x1b[0m=\x1b[35m0.3600000000005821\x1b[0m \x1b[36msuccess\x1b[0m=\x1b[35mTrue\x1b[0m\n\x1b[2m2026-02-01T13:23:17.660912Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob search completed          \x1b[0m \x1b[36mapis_called\x1b[0m=\x1b[35m2\x1b[0m \x1b[36mtotal_jobs\x1b[0m=\x1b[35m100\x1b[0m \x1b[36munique_jobs\x1b[0m=\x1b[35m100\x1b[0m\n\x1b[2m2026-02-01T13:23:21.301630Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mRealTimeWebScraper failed: \x1b[0m\n\x1b[2m2026-02-01T13:23:21.301630Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mFetched 100 raw leads         \x1b[0m \x1b[36mtelemetry\x1b[0m=\x1b[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 677.97, 'leads_found': 100}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4318.69, 'leads_found': 0}}\x1b[0m\n\x1b[2m2026-02-01T13:23:21.305726Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mScoring distribution          \x1b[0m \x1b[36mmax\x1b[0m=\x1b[35m60.2\x1b[0m \x1b[36mmean\x1b[0m=\x1b[35m40.202\x1b[0m \x1b[36mmin\x1b[0m=\x1b[35m40.0\x1b[0m \x1b[36mstd_dev\x1b[0m=\x1b[35m2.0200000000000005\x1b[0m\n\x1b[2m2026-02-01T13:23:21.309993Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mDeduplication & Density Check complete\x1b[0m \x1b[36mfinal\x1b[0m=\x1b[35m81\x1b[0m \x1b[36moriginal\x1b[0m=\x1b[35m100\x1b[0m \x1b[36msemantic_duplicates\x1b[0m=\x1b[35m0\x1b[0m\n\x1b[2m2026-02-01T13:23:21.309993Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mEnriched 81 leads with intelligence data\x1b[0m\n\x1b[2m2026-02-01T13:23:21.309993Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 3: Generating synthesis report\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:21.309993Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGenerating briefing           \x1b[0m \x1b[36mmodel\x1b[0m=\x1b[35mopenai/gpt-3.5-turbo\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:24.342555Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mBriefing generated successfully\x1b[0m \x1b[36mlength\x1b[0m=\x1b[35m1321\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:24.342555Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_STARTED             \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:24.550567Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4dd UPDATING_EXISTING_QUERY_RECORD\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:24.551660Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4ca DB_SAVE_EXECUTION_REPORT    \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:24.551660Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f465 DB_SAVE_LEADS_STARTED       \x1b[0m \x1b[36mlead_count\x1b[0m=\x1b[35m20\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:24.553114Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f504 DB_TRANSACTION_COMMIT_STARTED\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:24.554451Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 DB_TRANSACTION_COMMIT_COMPLETED\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m20\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:24.554451Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f4be DB_SAVE_COMPLETED_SUCCESSFULLY\x1b[0m \x1b[36mleads_saved\x1b[0m=\x1b[35m20\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m\n\x1b[2m2026-02-01T13:23:24.554451Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mRecruiter query processing completed\x1b[0m \x1b[36mleads_found\x1b[0m=\x1b[35m81\x1b[0m \x1b[36mprocessing_time\x1b[0m=\x1b[35m7.360167\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m14daf861-127e-4368-9e1e-f4059e251158\x1b[0m
____________________ test_pipeline_integration_with_search ____________________

    def test_pipeline_integration_with_search():
        async def run_async_test():
            pipeline = RecruiterPipeline()
            await pipeline.initialize()
    
            # Mock components
            pipeline.intelligence_engine.process = MagicMock(return_value=IntelligenceResult(
                intent="hiring", role="Engineer", skills=["Python"], experience=5, seniority="Senior", location="Remote",
                hiring_pressure=0.8, role_scarcity=0.7, outsourcing_likelihood=0.1, market_difficulty=0.6
            ))
    
            # Mock DB save
            pipeline._save_to_database = AsyncMock()
    
            # Mock Job API Manager to avoid network calls
            with patch("app.search.data_sources.job_api_manager") as mock_job_api:
                mock_job_api.search_jobs = AsyncMock(return_value=[
                    {"company": "MockCompany", "title": "MockRole", "url": "http://mock.com"}
                ])
    
                result = await pipeline.process_recruiter_query("Hiring Python Dev")
    
                assert result["status"] == "completed"
                assert "leads" in result
                assert "orchestration_summary" in result
                assert result["orchestration_summary"]["confidence"] >= 0
                assert len(result["leads"]) > 0
    
                # Check if leads have scores
                first_lead = result["leads"][0]
                assert "score" in first_lead
                assert "company" in first_lead
    
                # Verify DB save was called
                pipeline._save_to_database.assert_called_once()
    
                # Verify structure matches API contract
                assert "intelligence" in result
                assert "signals" in result
    
        import asyncio
>       asyncio.run(run_async_test())

tests\test_full_pipeline.py:56: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py:194: in run
    return runner.run(main)
           ^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\runners.py:118: in run
    return self._loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\base_events.py:687: in run_until_complete
    return future.result()
           ^^^^^^^^^^^^^^^
tests\test_full_pipeline.py:30: in run_async_test
    with patch("app.search.data_sources.job_api_manager") as mock_job_api:
..\..\..\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py:1458: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <unittest.mock._patch object at 0x00000286E03BB830>

    def get_original(self):
        target = self.getter()
        name = self.attribute
    
        original = DEFAULT
        local = False
    
        try:
            original = target.__dict__[name]
        except (AttributeError, KeyError):
            original = getattr(target, name, DEFAULT)
        else:
            local = True
    
        if name in _builtins and isinstance(target, ModuleType):
            self.create = True
    
        if not self.create and original is DEFAULT:
>           raise AttributeError(
                "%s does not have the attribute %r" % (target, name)
            )
E           AttributeError: <module 'app.search.data_sources' from 'C:\\Users\\ayush\\OneDrive\\Desktop\\AGENT 2\\app\\search\\data_sources.py'> does not have the attribute 'job_api_manager'

..\..\..\AppData\Local\Programs\Python\Python312\Lib\unittest\mock.py:1431: AttributeError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:32.485103Z[0m [[32m[1minfo     [0m] [1mRecruiter pipeline initialized and verified[0m
____________________________ test_signal_ordering _____________________________

    @pytest.mark.asyncio
    async def test_signal_ordering():
        # Urgently need senior AI engineers -> High pressure
>       res1 = await IntelligenceEngine.process("Urgently need senior AI engineers")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_intelligence_engine.py:36: TypeError
_______________________________ test_stability ________________________________

    @pytest.mark.asyncio
    async def test_stability():
        query = "Looking for Senior Data Scientist in Bangalore"
>       first_result = await IntelligenceEngine.process(query)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_intelligence_engine.py:48: TypeError
____________________________ test_boundary_general ____________________________

    @pytest.mark.asyncio
    async def test_boundary_general():
>       res = await IntelligenceEngine.process("hii")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_intelligence_engine.py:60: TypeError
_______________________________ test_robustness _______________________________

    @pytest.mark.asyncio
    async def test_robustness():
>       res = await IntelligenceEngine.process("Looking 4 ML devs in Blr ASAP")
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_intelligence_engine.py:67: TypeError
____________________ test_enrichment_fills_required_fields ____________________

    def test_enrichment_fills_required_fields():
        """Verify enrichment adds score and confidence from confidence_score."""
        lead = {
            "company_name": "Test Co",
            "confidence_score": 85.0  # From scorer
        }
    
        intelligence = {"role": "Engineer", "seniority": "Senior", "location": "Pune"}
        signals = {"hiring_pressure": 0.8, "role_scarcity": 0.6}
    
        enriched = LeadEnricher.enrich(lead, intelligence, signals)
    
        assert "score" in enriched
        assert "confidence" in enriched
        assert enriched["score"] == 85.0
>       assert enriched["confidence"] == 0.85  # 85/100
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       assert 0.818 == 0.85

tests\test_lead_enrichment.py:25: AssertionError
________________ test_enriched_lead_passes_contract_validation ________________

    def test_enriched_lead_passes_contract_validation():
        """Verify enriched leads pass LeadContract validation."""
        lead = {
            "company_name": "Valid Corp",
            "confidence_score": 88.0
        }
    
        intelligence = {"role": "Developer", "seniority": "Senior"}
        signals = {"hiring_pressure": 0.7}
    
        # Enrich
        enriched = LeadEnricher.enrich(lead, intelligence, signals)
    
        # Validate with contract
        clean = LeadContract.sanitize(enriched)
    
        assert clean is not None
        assert LeadContract.validate_required(clean)
        assert clean["company_name"] == "Valid Corp"
        assert clean["score"] == 88.0
>       assert clean["confidence"] == 0.88
E       assert 0.834 == 0.88

tests\test_lead_enrichment.py:82: AssertionError
___________________ test_end_to_end_enrichment_in_pipeline ____________________

    @pytest.mark.asyncio
    async def test_end_to_end_enrichment_in_pipeline():
        """Integration test: Verify enrichment works in full pipeline."""
        from app.intelligence.intelligence_engine import IntelligenceEngine
        from app.search.search_orchestrator import SearchOrchestrator
    
        query = "python developer in Bangalore"
    
        # Get intelligence
>       intel_result = await IntelligenceEngine.process(query)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_lead_enrichment.py:135: TypeError
___________________________ test_score_calculation ____________________________

mock_signals = {'hiring_pressure': 0.8, 'market_difficulty': 0.5, 'role_scarcity': 0.6}

    def test_score_calculation(mock_signals):
        lead = NormalizedLead(
            company_name="Test", role="Dev", location="Remote", job_url="", source="", skills=[],
            hiring_urgency="High", # +15
            company_growth_stage="High Growth", # +10
            funding_stage="Series A", # +10
            salary_range="100k" # +10
        )
        # Base: 50
        # Signals: 0.8 * 20 = 16, 0.6 * 15 = 9.  Total Signal: 25
        # Attributes: 15 + 10 + 10 + 10 = 45
        # Total: 50 + 25 + 45 = 120 -> Cap 100
    
        score = LeadScorer.compute_score(lead, mock_signals)
>       assert score == 100.0
E       assert 98.2 == 100.0

tests\test_lead_scoring.py:28: AssertionError
_________________________ test_low_score_calculation __________________________

mock_signals = {'hiring_pressure': 0.8, 'market_difficulty': 0.5, 'role_scarcity': 0.6}

    def test_low_score_calculation(mock_signals):
        lead = NormalizedLead(
            company_name="Test", role="Dev", location="Remote", job_url="", source="", skills=[],
            hiring_urgency="Low", # +5
            company_growth_stage="Stable", # +5
            funding_stage="Unknown", # 0
            salary_range=None # 0
        )
        # Base: 50
        # Signals: 25
        # Attributes: 10
        # Total: 85
    
        score = LeadScorer.compute_score(lead, mock_signals)
>       assert score == 85.0
E       assert 40.0 == 85.0

tests\test_lead_scoring.py:44: AssertionError
____________________________ test_missing_signals _____________________________

    def test_missing_signals():
        lead = NormalizedLead(company_name="T", role="R", location="L", job_url="", source="", skills=[])
        score = LeadScorer.compute_score(lead, {})
        # Base 50
        # Default signals: 0.5*20 + 0.5*15 = 10 + 7.5 = 17.5
        # Attributes: 0
        # Total: 67.5
>       assert score == 67.5
E       assert 40.0 == 67.5

tests\test_lead_scoring.py:53: AssertionError
_____________________ test_orchestration_summary_present ______________________

    @pytest.mark.asyncio
    async def test_orchestration_summary_present():
        """Verify orchestration_summary and strict metric contracts."""
        # Setup DEV mode
        settings.logging.mode = ExecutionMode.DEV
        settings.agent.enable_mock_sources = True
    
        orch = SearchOrchestrator()
        result = await orch.orchestrate("python developer", {"intelligence": {}, "signals": {}})
    
        # Check Summary Presence
        assert "orchestration_summary" in result
        summary = result["orchestration_summary"]
    
        # Check Fidelity Metrics
>       assert summary["total_raw_leads"] > 0
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
E       KeyError: 'total_raw_leads'

tests\test_observability.py:21: KeyError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:32.856385Z[0m [[32m[1minfo     [0m] [1mPublic APIs ENABLED           [0m [36marbeitnow[0m=[35mTrue[0m [36mgithub[0m=[35mFalse[0m
[2m2026-02-01T13:23:32.856385Z[0m [[32m[1minfo     [0m] [1mReal-Time Web Scraper ENABLED (DuckDuckGo/LinkedIn/Indeed)[0m
[2m2026-02-01T13:23:32.856385Z[0m [[32m[1minfo     [0m] [1mMock Data Sources ENABLED[0m
[2m2026-02-01T13:23:32.856385Z[0m [[32m[1minfo     [0m] [1mSearchOrchestrator initialized with 3 providers[0m [36mproviders[0m=[35m['MockJobBoard', 'RealTimeWebScraper', 'MockCompanyAPI'][0m
[2m2026-02-01T13:23:32.856824Z[0m [[32m[1minfo     [0m] [1mStarting Search Orchestration [0m [36mmode[0m=[35mdev[0m [36mquery[0m=[35mpython developer[0m
[2m2026-02-01T13:23:32.856824Z[0m [[32m[1minfo     [0m] [1mQuery parsed: python developer, Role: python developer[0m
[2m2026-02-01T13:23:32.856824Z[0m [[32m[1minfo     [0m] [1mFetching from JobAPIManager: python developer[0m
[2m2026-02-01T13:23:32.856824Z[0m [[32m[1minfo     [0m] [1mRealTimeWebScraper: Searching for 'python developer'[0m
[2m2026-02-01T13:23:33.176282Z[0m [[32m[1minfo     [0m] [1mFetching Arbeitnow jobs       [0m [36mparams[0m=[35m{'search': 'python developer', 'location': 'remote', 'limit': 2}[0m
[2m2026-02-01T13:23:33.176282Z[0m [[32m[1minfo     [0m] [1mapi_call                      [0m [36mapi[0m=[35marbeitnow[0m [36mendpoint[0m=[35mhttps://www.arbeitnow.com/api/job-board-api[0m [36merror[0m=[35mEvent loop is closed[0m [36mlatency[0m=[35m0.0[0m [36msuccess[0m=[35mFalse[0m
[2m2026-02-01T13:23:33.176282Z[0m [[31m[1merror    [0m] [1mArbeitnow API call failed     [0m [36merror[0m=[35mEvent loop is closed[0m
[2m2026-02-01T13:23:33.176282Z[0m [[32m[1minfo     [0m] [1mFetching RemoteOK jobs        [0m [36mquery[0m=[35mpython developer[0m
[2m2026-02-01T13:23:33.369647Z[0m [[32m[1minfo     [0m] [1mapi_call                      [0m [36mapi[0m=[35mremoteok[0m [36mendpoint[0m=[35mhttps://remoteok.com/api[0m [36mjobs_found[0m=[35m3[0m [36mlatency[0m=[35m0.1879999999946449[0m [36msuccess[0m=[35mTrue[0m
[2m2026-02-01T13:23:33.369647Z[0m [[32m[1minfo     [0m] [1mJob search completed          [0m [36mapis_called[0m=[35m2[0m [36mtotal_jobs[0m=[35m3[0m [36munique_jobs[0m=[35m3[0m
[2m2026-02-01T13:23:37.193164Z[0m [[31m[1merror    [0m] [1mRealTimeWebScraper failed: [0m
[2m2026-02-01T13:23:37.193164Z[0m [[32m[1minfo     [0m] [1mFetched 3 raw leads           [0m [36mtelemetry[0m=[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 512.82, 'leads_found': 3}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4336.34, 'leads_found': 0}}[0m
[2m2026-02-01T13:23:37.193164Z[0m [[32m[1minfo     [0m] [1mScoring distribution          [0m [36mmax[0m=[35m40.0[0m [36mmean[0m=[35m40.0[0m [36mmin[0m=[35m40.0[0m [36mstd_dev[0m=[35m0.0[0m
[2m2026-02-01T13:23:37.193164Z[0m [[32m[1minfo     [0m] [1mDeduplication & Density Check complete[0m [36mfinal[0m=[35m3[0m [36moriginal[0m=[35m3[0m [36msemantic_duplicates[0m=[35m0[0m
[2m2026-02-01T13:23:37.193164Z[0m [[32m[1minfo     [0m] [1mEnriched 3 leads with intelligence data[0m
______________________ test_provider_telemetry_attached _______________________

    @pytest.mark.asyncio
    async def test_provider_telemetry_attached():
        """Verify granular provider telemetry in both summary and metrics."""
        settings.agent.enable_mock_sources = True
        orch = SearchOrchestrator()
        result = await orch.orchestrate("python developer", {"intelligence": {}, "signals": {}})
    
        # 1. In Metrics
        assert "metrics" in result
        diagnostics = result["metrics"]["provider_diagnostics"]
>       assert "MockStartupDB" in diagnostics
E       AssertionError: assert 'MockStartupDB' in {'MockCompanyAPI': {'latency_ms': 0.0, 'leads_found': 0, 'status': 'success'}, 'MockJobBoard': {'latency_ms': 536.68, 'leads_found': 100, 'status': 'success'}, 'RealTimeWebScraper': {'latency_ms': 4373.9, 'leads_found': 0, 'status': 'success'}}

tests\test_observability.py:45: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:37.209667Z[0m [[32m[1minfo     [0m] [1mPublic APIs ENABLED           [0m [36marbeitnow[0m=[35mTrue[0m [36mgithub[0m=[35mFalse[0m
[2m2026-02-01T13:23:37.209667Z[0m [[32m[1minfo     [0m] [1mReal-Time Web Scraper ENABLED (DuckDuckGo/LinkedIn/Indeed)[0m
[2m2026-02-01T13:23:37.209667Z[0m [[32m[1minfo     [0m] [1mMock Data Sources ENABLED[0m
[2m2026-02-01T13:23:37.209667Z[0m [[32m[1minfo     [0m] [1mSearchOrchestrator initialized with 3 providers[0m [36mproviders[0m=[35m['MockJobBoard', 'RealTimeWebScraper', 'MockCompanyAPI'][0m
[2m2026-02-01T13:23:37.209667Z[0m [[32m[1minfo     [0m] [1mStarting Search Orchestration [0m [36mmode[0m=[35mdev[0m [36mquery[0m=[35mpython developer[0m
[2m2026-02-01T13:23:37.209667Z[0m [[32m[1minfo     [0m] [1mQuery parsed: python developer, Role: python developer[0m
[2m2026-02-01T13:23:37.209667Z[0m [[32m[1minfo     [0m] [1mFetching from JobAPIManager: python developer[0m
[2m2026-02-01T13:23:37.209667Z[0m [[32m[1minfo     [0m] [1mRealTimeWebScraper: Searching for 'python developer'[0m
[2m2026-02-01T13:23:37.563229Z[0m [[32m[1minfo     [0m] [1mFetching Arbeitnow jobs       [0m [36mparams[0m=[35m{'search': 'python developer', 'location': 'remote', 'limit': 2}[0m
[2m2026-02-01T13:23:37.563229Z[0m [[32m[1minfo     [0m] [1mFetching RemoteOK jobs        [0m [36mquery[0m=[35mpython developer[0m
[2m2026-02-01T13:23:37.565235Z[0m [[32m[1minfo     [0m] [1mapi_call                      [0m [36mapi[0m=[35mremoteok[0m [36mendpoint[0m=[35mhttps://remoteok.com/api[0m [36merror[0m=[35mEvent loop is closed[0m [36mlatency[0m=[35m0.0[0m [36msuccess[0m=[35mFalse[0m
[2m2026-02-01T13:23:37.565235Z[0m [[31m[1merror    [0m] [1mRemoteOK API call failed      [0m [36merror[0m=[35mEvent loop is closed[0m
[2m2026-02-01T13:23:37.746352Z[0m [[32m[1minfo     [0m] [1mapi_call                      [0m [36mapi[0m=[35marbeitnow[0m [36mendpoint[0m=[35mhttps://www.arbeitnow.com/api/job-board-api[0m [36mjobs_found[0m=[35m100[0m [36mlatency[0m=[35m0.17199999999138527[0m [36msuccess[0m=[35mTrue[0m
[2m2026-02-01T13:23:37.746352Z[0m [[32m[1minfo     [0m] [1mJob search completed          [0m [36mapis_called[0m=[35m2[0m [36mtotal_jobs[0m=[35m100[0m [36munique_jobs[0m=[35m100[0m
[2m2026-02-01T13:23:41.583563Z[0m [[31m[1merror    [0m] [1mRealTimeWebScraper failed: [0m
[2m2026-02-01T13:23:41.583563Z[0m [[32m[1minfo     [0m] [1mFetched 100 raw leads         [0m [36mtelemetry[0m=[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'MockJobBoard': {'status': 'success', 'latency_ms': 536.68, 'leads_found': 100}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4373.9, 'leads_found': 0}}[0m
[2m2026-02-01T13:23:41.590215Z[0m [[32m[1minfo     [0m] [1mScoring distribution          [0m [36mmax[0m=[35m60.1[0m [36mmean[0m=[35m40.201[0m [36mmin[0m=[35m40.0[0m [36mstd_dev[0m=[35m2.0100000000000002[0m
[2m2026-02-01T13:23:41.590215Z[0m [[32m[1minfo     [0m] [1mDeduplication & Density Check complete[0m [36mfinal[0m=[35m81[0m [36moriginal[0m=[35m100[0m [36msemantic_duplicates[0m=[35m0[0m
[2m2026-02-01T13:23:41.591223Z[0m [[32m[1minfo     [0m] [1mEnriched 81 leads with intelligence data[0m
__________________ test_lead_contract_strips_unknown_fields ___________________

    def test_lead_contract_strips_unknown_fields():
        """Verify LeadContract strips fields not in DB schema."""
        lead_with_extra_fields = {
            "company": "Test Co",
            "score": 85,
            "confidence": 0.9,
            "evidence_count": 5,  # NOT in DB schema
            "title": "Engineer",  # NOT in DB schema
            "location": "Pune",  # NOT in DB schema
            "unknown_field": "value"  # NOT in DB schema
        }
    
        clean = LeadContract.sanitize(lead_with_extra_fields)
    
        assert clean is not None
        assert "company_name" in clean  # Normalized from 'company'
        assert "score" in clean
        assert "confidence" in clean
    
        # These should be stripped
        assert "evidence_count" not in clean
        assert "title" not in clean
>       assert "location" not in clean
E       AssertionError: assert 'location' not in {'company_name': 'Test Co', 'confidence': 0.9, 'evidence_objects': [], 'job_postings': [], ...}

tests\test_pipeline_contract.py:34: AssertionError
______________________ test_location_contract_end_to_end ______________________

    @pytest.mark.asyncio
    async def test_location_contract_end_to_end():
        """Integration test: Verify location flows from intelligence to search."""
        query = "backend engineers in Pune"
    
        # Step 1: Intelligence extraction
>       intel_result = await IntelligenceEngine.process(query)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_pipeline_contract.py:89: TypeError
________________________ test_partial_failure_handling ________________________

    @pytest.mark.asyncio
    async def test_partial_failure_handling():
        """Verify valid leads are saved even when some are invalid."""
        from app.contracts.lead_contract import LeadContract
    
        leads = [
            {"company": "Valid Co 1", "score": 85, "confidence": 0.9},
            "invalid_structure",  # Will be rejected
            {"company": "Valid Co 2", "score": 90, "confidence": 0.95},
            {"score": 80},  # Missing company, will be defaulted
            {"company": "Valid Co 3", "score": 88, "confidence": 0.92}
        ]
    
        valid_count = 0
        for lead in leads:
            clean = LeadContract.sanitize(lead)
            if clean and LeadContract.validate_required(clean):
                valid_count += 1
    
        # Should have 4 valid (3 explicit + 1 with defaulted company)
>       assert valid_count == 4
E       assert 3 == 4

tests\test_pipeline_contract.py:159: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:46.437419Z[0m [[33m[1mwarning  [0m] [1mInvalid lead data type        [0m [36mtype[0m=[35mstr[0m
[2m2026-02-01T13:23:46.437419Z[0m [[33m[1mwarning  [0m] [1mLead missing company_name, defaulted to 'Unknown Company'[0m
_____________ test_search_orchestrator_respects_location_contract _____________

    @pytest.mark.asyncio
    async def test_search_orchestrator_respects_location_contract():
        """Verify location is not overridden if provided by intelligence."""
        orchestrator = SearchOrchestrator()
        query = "dev"
    
        # Case 1: Intelligence provides location
        intel_data = {
            "intelligence": {"location": "Pune", "role": "dev"},
            "signals": {}
        }
    
        # We mock the sources fetch to check constraints passed to it
        from unittest.mock import AsyncMock
        original_sources = orchestrator.sources
        mock_source = AsyncMock()
        mock_source.fetch.return_value = []
        orchestrator.sources = [mock_source]
    
        await orchestrator.orchestrate(query, intel_data)
    
        # Verify constraints passed to source
        call_args = mock_source.fetch.call_args
        constraints = call_args[0][1] # second arg
>       assert constraints["location"] == "Pune"
E       AssertionError: assert 'Remote' == 'Pune'
E         
E         - Pune
E         + Remote

tests\test_pipeline_stress.py:62: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:46.497864Z[0m [[32m[1minfo     [0m] [1mPublic APIs ENABLED           [0m [36marbeitnow[0m=[35mTrue[0m [36mgithub[0m=[35mFalse[0m
[2m2026-02-01T13:23:46.497864Z[0m [[32m[1minfo     [0m] [1mReal-Time Web Scraper ENABLED (DuckDuckGo/LinkedIn/Indeed)[0m
[2m2026-02-01T13:23:46.497864Z[0m [[32m[1minfo     [0m] [1mMock Data Sources ENABLED[0m
[2m2026-02-01T13:23:46.497864Z[0m [[32m[1minfo     [0m] [1mSearchOrchestrator initialized with 3 providers[0m [36mproviders[0m=[35m['MockJobBoard', 'RealTimeWebScraper', 'MockCompanyAPI'][0m
[2m2026-02-01T13:23:46.498868Z[0m [[32m[1minfo     [0m] [1mStarting Search Orchestration [0m [36mmode[0m=[35mdev[0m [36mquery[0m=[35mdev[0m
[2m2026-02-01T13:23:46.498868Z[0m [[32m[1minfo     [0m] [1mQuery parsed: dev, Role: dev[0m
[2m2026-02-01T13:23:46.498868Z[0m [[32m[1minfo     [0m] [1mFetched 0 raw leads           [0m [36mtelemetry[0m=[35m{'AsyncMock': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}}[0m
[2m2026-02-01T13:23:46.498868Z[0m [[31m[1mcritical [0m] [1mHEALTH CHECK FAILED: 0 leads fetched[0m [36mtelemetry[0m=[35m{'AsyncMock': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}}[0m
[2m2026-02-01T13:23:46.498868Z[0m [[32m[1minfo     [0m] [1mEnriched 0 leads with intelligence data[0m
_____________________ test_pipeline_validation_gate_unit ______________________

    @pytest.mark.asyncio
    async def test_pipeline_validation_gate_unit():
        """Verify LeadValidator is called and filters invalid leads."""
        from app.search.lead_validator import LeadValidator
    
        # Test 1: Valid lead passes through
        valid_lead = {"company": "Test Co", "score": 85, "confidence": 0.9}
        result = LeadValidator.validate_and_fix(valid_lead)
        assert result is not None
        assert result["company"] == "Test Co"
    
        # Test 2: Missing company gets defaulted
        missing_company = {"score": 85, "confidence": 0.9}
        result = LeadValidator.validate_and_fix(missing_company)
        assert result is not None
        assert result["company"] == "Unknown Company"
    
        # Test 3: Non-dict gets rejected
        invalid_structure = "not a dict"
        result = LeadValidator.validate_and_fix(invalid_structure)
        assert result is None
    
        # Test 4: Numeric validation
        bad_numbers = {"company": "Test", "score": "invalid", "confidence": 2.0}
        result = LeadValidator.validate_and_fix(bad_numbers)
        assert result is not None
        assert result["score"] == 0.0  # Invalid score defaulted
>       assert result["confidence"] == 1.0  # Clamped
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       assert 0.0 == 1.0

tests\test_pipeline_stress.py:104: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:46.515018Z[0m [[33m[1mwarning  [0m] [1mLead missing company name, defaulted to 'Unknown Company'[0m [36murl[0m=[35mno-url[0m
[2m2026-02-01T13:23:46.515018Z[0m [[33m[1mwarning  [0m] [1mInvalid lead data type        [0m [36mtype[0m=[35m<class 'str'>[0m
[2m2026-02-01T13:23:46.515018Z[0m [[33m[1mwarning  [0m] [1mInvalid score/confidence types[0m [36mconfidence[0m=[35m2.0[0m [36mscore[0m=[35minvalid[0m
______________________ test_end_to_end_location_contract ______________________

    @pytest.mark.asyncio
    async def test_end_to_end_location_contract():
        """Integration test: Verify location flows from intelligence to search."""
        from app.intelligence.intelligence_engine import IntelligenceEngine
        from app.search.search_orchestrator import SearchOrchestrator
    
        # Test query with specific location
        query = "backend engineers in Pune"
    
        # Step 1: Intelligence extraction
>       intel_result = await IntelligenceEngine.process(query)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_pipeline_stress.py:116: TypeError
____________ TestStartupIntegrity.test_zero_providers_raises_error ____________

self = <tests.test_platform_unification.TestStartupIntegrity object at 0x00000286DFA5C7A0>

    def test_zero_providers_raises_error(self):
        """SearchOrchestrator should fail fast with zero providers."""
        from app.search.search_orchestrator import SearchOrchestrator
    
        with patch('app.config.settings') as mock_settings:
            mock_settings.logging.mode = MagicMock()
            mock_settings.logging.mode.value = "dev"
            mock_settings.agent.enable_arbeitnow = False
            mock_settings.agent.enable_github_jobs = False
            mock_settings.agent.enable_mock_sources = False
    
>           with pytest.raises(RuntimeError, match="No search providers enabled"):
E           Failed: DID NOT RAISE <class 'RuntimeError'>

tests\test_platform_unification.py:107: Failed
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:50.944003Z[0m [[32m[1minfo     [0m] [1mReal-Time Web Scraper ENABLED (DuckDuckGo/LinkedIn/Indeed)[0m
[2m2026-02-01T13:23:50.944003Z[0m [[32m[1minfo     [0m] [1mSearchOrchestrator initialized with 1 providers[0m [36mproviders[0m=[35m['RealTimeWebScraper'][0m
________ TestExecutionConsistency.test_orchestration_summary_populated ________

self = <tests.test_platform_unification.TestExecutionConsistency object at 0x00000286DFA5CEC0>

    @pytest.mark.asyncio
    async def test_orchestration_summary_populated(self):
        """orchestration_summary should always be populated."""
        from app.services.pipeline import RecruiterPipeline
    
        pipeline = RecruiterPipeline()
        await pipeline.initialize()
    
        result = await pipeline.process_recruiter_query(
            "Data Scientist",
            recruiter_id="test-002"
        )
    
>       assert "orchestration_summary" in result
E       assert 'orchestration_summary' in {'error': "object IntelligenceResult can't be used in 'await' expression", 'leads': [], 'original_query': 'Data Scientist', 'processing_time': 0.001505, ...}

tests\test_platform_unification.py:144: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:50.974172Z[0m [[32m[1minfo     [0m] [1mRecruiter pipeline initialized and verified[0m
[2m2026-02-01T13:23:50.974172Z[0m [[32m[1minfo     [0m] [1mStarting recruiter query processing[0m [36mquery[0m=[35mData Scientist[0m [36mquery_id[0m=[35m01b29fb9-90e2-4e9d-b8a7-69dc6d107ae2[0m [36mrecruiter_id[0m=[35mtest-002[0m
[2m2026-02-01T13:23:50.974172Z[0m [[32m[1minfo     [0m] [1mStep 1: Intelligence Engine   [0m [36mquery_id[0m=[35m01b29fb9-90e2-4e9d-b8a7-69dc6d107ae2[0m
[2m2026-02-01T13:23:50.974172Z[0m [[31m[1merror    [0m] [1mPipeline processing failed    [0m [36merror[0m=[35mobject IntelligenceResult can't be used in 'await' expression[0m [36mquery_id[0m=[35m01b29fb9-90e2-4e9d-b8a7-69dc6d107ae2[0m
___________________ test_score_soft_cap_prevents_saturation ___________________

    def test_score_soft_cap_prevents_saturation():
        """Verify scores don't saturate at 100 too easily."""
        # Test soft cap function directly
>       assert LeadScorer._apply_soft_cap(50.0) < 90.0  # Should be ~86
               ^^^^^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: type object 'LeadScorer' has no attribute '_apply_soft_cap'

tests\test_production_hardening.py:16: AttributeError
____________________ test_deduplication_removes_duplicates ____________________

    def test_deduplication_removes_duplicates():
        """Verify deduplication removes duplicate companies."""
        leads = [
>           NormalizedLead(
                company_name="TechCorp",
                role="Engineer",
                location="Pune",
                job_url="http://test1.com",
                source="test",
                confidence_score=90.0
            ),
            NormalizedLead(
                company_name="TechCorp",  # Duplicate
                role="Engineer",
                location="Pune",
                job_url="http://test2.com",
                source="test",
                confidence_score=85.0
            ),
            NormalizedLead(
                company_name="DataCo",
                role="Analyst",
                location="Mumbai",
                job_url="http://test3.com",
                source="test",
                confidence_score=88.0
            )
        ]
E       TypeError: NormalizedLead.__init__() missing 1 required positional argument: 'skills'

tests\test_production_hardening.py:44: TypeError
_____________________ test_deduplication_preserves_order ______________________

    def test_deduplication_preserves_order():
        """Verify deduplication maintains ranking order."""
        leads = [
>           NormalizedLead(
                company_name=f"Company{i}",
                role="Engineer",
                location="Remote",
                job_url=f"http://test{i}.com",
                source="test",
                confidence_score=100.0 - i
            )
            for i in range(10)
        ]
E       TypeError: NormalizedLead.__init__() missing 1 required positional argument: 'skills'

tests\test_production_hardening.py:82: TypeError
____________________ test_score_distribution_not_clustered ____________________

    def test_score_distribution_not_clustered():
        """Verify scores have good distribution, not clustered at 100."""
        leads = []
        for i in range(20):
>           lead = NormalizedLead(
                company_name=f"Company{i}",
                role="Engineer",
                location="Remote",
                job_url=f"http://test{i}.com",
                source="test"
            )
E           TypeError: NormalizedLead.__init__() missing 1 required positional argument: 'skills'

tests\test_production_hardening.py:158: TypeError
__________________________ test_end_to_end_hardening __________________________

    @pytest.mark.asyncio
    async def test_end_to_end_hardening():
        """Integration test: Verify all hardening changes work together."""
        from app.intelligence.intelligence_engine import IntelligenceEngine
        from app.search.search_orchestrator import SearchOrchestrator
    
        query = "senior python developer in Bangalore"
    
        # Get intelligence
>       intel_result = await IntelligenceEngine.process(query)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_production_hardening.py:194: TypeError
_______________________ test_query_status_returns_leads _______________________

self = <sqlalchemy.engine.base.Connection object at 0x00000286E0197AD0>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286E14FFB00>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x00000286E040B350>
parameters = [('07c41c85-833c-4111-89de-59915174ff9f', 'test', 'python developer', None, 'completed', 0.0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1969: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
cursor = <sqlite3.Cursor object at 0x00000286DFA57CC0>
statement = 'INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, created_at, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('07c41c85-833c-4111-89de-59915174ff9f', 'test', 'python developer', None, 'completed', 0.0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286E14FFB00>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: queries

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\default.py:922: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.mark.asyncio
    async def test_query_status_returns_leads():
        """Verify get_query_status returns leads without errors."""
        query_text = "python developer"
        query_id = str(uuid.uuid4())
    
        # Create query and leads
        db = SessionLocal()
        try:
            query_record = Query(
                id=query_id,
                recruiter_id="test",
                query_text=query_text,
                processing_status="completed",
                created_at=datetime.utcnow()
            )
            db.add(query_record)
    
            # Add test lead
            lead = Lead(
                query_id=query_id,
                company_name="Test Corp",
                score=85.0,
                confidence=0.85,
                reasons=["test reason"]
            )
            db.add(lead)
>           db.commit()

tests\test_query_read_model.py:40: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1969: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1256: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1231: in _prepare_impl
    self.session.flush()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4312: in flush
    self._flush(objects)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4447: in _flush
    with util.safe_reraise():
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\util\langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4408: in _flush
    flush_context.execute()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\persistence.py:1043: in _emit_insert_statements
    result = connection.execute(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1416: in execute
    return meth(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\sql\elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1848: in _execute_context
    return self._exec_single_context(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1969: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
cursor = <sqlite3.Cursor object at 0x00000286DFA57CC0>
statement = 'INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, created_at, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('07c41c85-833c-4111-89de-59915174ff9f', 'test', 'python developer', None, 'completed', 0.0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286E14FFB00>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: queries
E       [SQL: INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, created_at, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('07c41c85-833c-4111-89de-59915174ff9f', 'test', 'python developer', None, 'completed', 0.0, None, '[]', None, '2026-02-01 13:23:51.096010', None)]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\default.py:922: OperationalError
_______________________ test_api_response_serialization _______________________

self = <sqlalchemy.engine.base.Connection object at 0x00000286E01C1B80>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286E01C1F10>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x00000286E040B350>
parameters = [('7ed21711-99df-49dd-827f-779a6a894a57', 'test', 'backend engineer', None, 'completed', 0.0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1969: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
cursor = <sqlite3.Cursor object at 0x00000286E377D9C0>
statement = 'INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, created_at, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('7ed21711-99df-49dd-827f-779a6a894a57', 'test', 'backend engineer', None, 'completed', 0.0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286E01C1F10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: queries

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\default.py:922: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.mark.asyncio
    async def test_api_response_serialization():
        """Verify API responses can be serialized without errors."""
        import json
    
        query_text = "backend engineer"
        query_id = str(uuid.uuid4())
    
        # Create query and lead
        db = SessionLocal()
        try:
            query_record = Query(
                id=query_id,
                recruiter_id="test",
                query_text=query_text,
                processing_status="completed",
                created_at=datetime.utcnow()
            )
            db.add(query_record)
    
            lead = Lead(
                query_id=query_id,
                company_name="Serialization Test Corp",
                score=90.0,
                confidence=0.9,
                reasons=["reason 1", "reason 2"]
            )
            db.add(lead)
>           db.commit()

tests\test_query_read_model.py:106: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1969: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1256: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1231: in _prepare_impl
    self.session.flush()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4312: in flush
    self._flush(objects)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4447: in _flush
    with util.safe_reraise():
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\util\langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4408: in _flush
    flush_context.execute()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\persistence.py:1043: in _emit_insert_statements
    result = connection.execute(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1416: in execute
    return meth(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\sql\elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1848: in _execute_context
    return self._exec_single_context(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1969: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
cursor = <sqlite3.Cursor object at 0x00000286E377D9C0>
statement = 'INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, created_at, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('7ed21711-99df-49dd-827f-779a6a894a57', 'test', 'backend engineer', None, 'completed', 0.0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286E01C1F10>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: queries
E       [SQL: INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, created_at, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('7ed21711-99df-49dd-827f-779a6a894a57', 'test', 'backend engineer', None, 'completed', 0.0, None, '[]', None, '2026-02-01 13:23:51.514938', None)]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\default.py:922: OperationalError
_____________________ test_end_to_end_query_and_retrieve ______________________

self = <sqlalchemy.engine.base.Connection object at 0x00000286DFF53500>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286DFF53680>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x00000286E040B350>
parameters = [('e01cfca7-dd01-44c3-a5ce-0ad1918d6dcc', 'integration-test', 'senior data scientist in Mumbai', None, 'processing', 0.0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1969: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
cursor = <sqlite3.Cursor object at 0x00000286E30C8440>
statement = 'INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, created_at, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('e01cfca7-dd01-44c3-a5ce-0ad1918d6dcc', 'integration-test', 'senior data scientist in Mumbai', None, 'processing', 0.0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286DFF53680>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: queries

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\default.py:922: OperationalError

The above exception was the direct cause of the following exception:

    @pytest.mark.asyncio
    async def test_end_to_end_query_and_retrieve():
        """Integration test: Create query, process, retrieve results."""
        query_text = "senior data scientist in Mumbai"
        query_id = str(uuid.uuid4())
    
        # Create query record
        db = SessionLocal()
        try:
            query_record = Query(
                id=query_id,
                recruiter_id="integration-test",
                query_text=query_text,
                processing_status="processing",
                created_at=datetime.utcnow()
            )
            db.add(query_record)
>           db.commit()

tests\test_query_read_model.py:137: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1969: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1256: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1231: in _prepare_impl
    self.session.flush()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4312: in flush
    self._flush(objects)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4447: in _flush
    with util.safe_reraise():
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\util\langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4408: in _flush
    flush_context.execute()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\persistence.py:1043: in _emit_insert_statements
    result = connection.execute(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1416: in execute
    return meth(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\sql\elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1848: in _execute_context
    return self._exec_single_context(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1969: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
cursor = <sqlite3.Cursor object at 0x00000286E30C8440>
statement = 'INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, created_at, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)'
parameters = ('e01cfca7-dd01-44c3-a5ce-0ad1918d6dcc', 'integration-test', 'senior data scientist in Mumbai', None, 'processing', 0.0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286DFF53680>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: queries
E       [SQL: INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, created_at, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)]
E       [parameters: ('e01cfca7-dd01-44c3-a5ce-0ad1918d6dcc', 'integration-test', 'senior data scientist in Mumbai', None, 'processing', 0.0, None, '[]', None, '2026-02-01 13:23:51.901827', None)]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\default.py:922: OperationalError
______________________ test_lead_normalization_defaults _______________________

    def test_lead_normalization_defaults():
        raw_data = {"company": "Test Corp", "title": "Dev"}
        normalized = LeadNormalizer.normalize(raw_data)
>       assert normalized.company_name == "Test Corp"
               ^^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'NoneType' object has no attribute 'company_name'

tests\test_search_engine.py:8: AttributeError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:52.441173Z[0m [[33m[1mwarning  [0m] [1mSkipping lead with missing source[0m [36mcompany[0m=[35mTest[0m [36mreason[0m=[35mmissing_source[0m [36mrole[0m=[35mDev[0m
___________________ test_lead_normalization_with_all_fields ___________________

    def test_lead_normalization_with_all_fields():
        raw_data = {
            "company": "Test Corp",
            "title": "Dev",
            "location": "Berlin",
            "url": "http://test.com",
            "skills": ["Python", "AI"],
            "salary_range": "100k",
            "hiring_urgency": "High",
            "growth_stage": "Stable",
            "funding": "Series A"
        }
        normalized = LeadNormalizer.normalize(raw_data)
>       assert normalized.location == "Berlin"
               ^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'NoneType' object has no attribute 'location'

tests\test_search_engine.py:26: AttributeError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:52.455700Z[0m [[33m[1mwarning  [0m] [1mSkipping lead with missing source[0m [36mcompany[0m=[35mTest[0m [36mreason[0m=[35mmissing_source[0m [36mrole[0m=[35mDev[0m
______________________ test_lead_normalization_inference ______________________

    def test_lead_normalization_inference():
        raw_data = {
            "company": "Test Corp",
            "title": "Dev",
            "description": "We need someone asap for this urgent role"
        }
        normalized = LeadNormalizer.normalize(raw_data)
>       assert normalized.hiring_urgency == "High"
               ^^^^^^^^^^^^^^^^^^^^^^^^^
E       AttributeError: 'NoneType' object has no attribute 'hiring_urgency'

tests\test_search_engine.py:38: AttributeError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:52.467227Z[0m [[33m[1mwarning  [0m] [1mSkipping lead with missing source[0m [36mcompany[0m=[35mTest[0m [36mreason[0m=[35mmissing_source[0m [36mrole[0m=[35mDev[0m
____________________ test_startup_fails_with_no_providers _____________________

    @pytest.mark.asyncio
    async def test_startup_fails_with_no_providers():
        """Verify that SearchOrchestrator raises RuntimeError if no provider is enabled."""
        # Temporarily disable all providers
        original_mocks = settings.agent.enable_mock_sources
        original_arbeitnow = settings.agent.enable_arbeitnow
        original_github = settings.agent.enable_github_jobs
    
        settings.agent.enable_mock_sources = False
        settings.agent.enable_arbeitnow = False
        settings.agent.enable_github_jobs = False
    
        try:
>           with pytest.raises(RuntimeError) as excinfo:
E           Failed: DID NOT RAISE <class 'RuntimeError'>

tests\test_search_integrity.py:20: Failed
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:52.481420Z[0m [[32m[1minfo     [0m] [1mReal-Time Web Scraper ENABLED (DuckDuckGo/LinkedIn/Indeed)[0m
[2m2026-02-01T13:23:52.482428Z[0m [[32m[1minfo     [0m] [1mSearchOrchestrator initialized with 1 providers[0m [36mproviders[0m=[35m['RealTimeWebScraper'][0m
_______________________ test_search_mode_provider_logic _______________________

    @pytest.mark.asyncio
    async def test_search_mode_provider_logic():
        """Verify SearchMode validation logic (via config)."""
        # This tests the Model Validator in config.py
        # We can't easily re-instantiate settings here without reloading env,
        # but we can verify the logic by manually calling the validator or trusting pydantic.
        # Instead, let's verify SearchOrchestrator respects flags.
    
        # 1. Enable ONLY Mocks
        settings.agent.enable_mock_sources = True
        settings.agent.enable_arbeitnow = False
        settings.agent.enable_github_jobs = False
    
        orch = SearchOrchestrator()
        provider_names = [s.__class__.__name__ for s in orch.sources]
>       assert "MockStartupDB" in provider_names
E       AssertionError: assert 'MockStartupDB' in ['RealTimeWebScraper', 'MockCompanyAPI']

tests\test_search_integrity.py:44: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:52.495747Z[0m [[32m[1minfo     [0m] [1mReal-Time Web Scraper ENABLED (DuckDuckGo/LinkedIn/Indeed)[0m
[2m2026-02-01T13:23:52.495747Z[0m [[32m[1minfo     [0m] [1mMock Data Sources ENABLED[0m
[2m2026-02-01T13:23:52.495747Z[0m [[32m[1minfo     [0m] [1mSearchOrchestrator initialized with 2 providers[0m [36mproviders[0m=[35m['RealTimeWebScraper', 'MockCompanyAPI'][0m
__________________________ test_telemetry_generation __________________________

    @pytest.mark.asyncio
    async def test_telemetry_generation():
        """Verify that telemetry is generated and exposed."""
        # Enable mocks
        settings.agent.enable_mock_sources = True
        settings.agent.enable_arbeitnow = False
    
        orch = SearchOrchestrator()
    
        # Run orchestrate
        result = await orch.orchestrate("python developer", {"intelligence": {}, "signals": {}})
    
        assert "metrics" in result
        metrics = result["metrics"]
        assert "provider_diagnostics" in metrics
        diagnostics = metrics["provider_diagnostics"]
    
        # Check if we have entries
>       assert "MockStartupDB" in diagnostics
E       AssertionError: assert 'MockStartupDB' in {'MockCompanyAPI': {'latency_ms': 0.0, 'leads_found': 0, 'status': 'success'}, 'RealTimeWebScraper': {'latency_ms': 4329.34, 'leads_found': 0, 'status': 'success'}}

tests\test_search_integrity.py:74: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:23:52.513320Z[0m [[32m[1minfo     [0m] [1mReal-Time Web Scraper ENABLED (DuckDuckGo/LinkedIn/Indeed)[0m
[2m2026-02-01T13:23:52.513320Z[0m [[32m[1minfo     [0m] [1mMock Data Sources ENABLED[0m
[2m2026-02-01T13:23:52.513320Z[0m [[32m[1minfo     [0m] [1mSearchOrchestrator initialized with 2 providers[0m [36mproviders[0m=[35m['RealTimeWebScraper', 'MockCompanyAPI'][0m
[2m2026-02-01T13:23:52.513320Z[0m [[32m[1minfo     [0m] [1mStarting Search Orchestration [0m [36mmode[0m=[35mdev[0m [36mquery[0m=[35mpython developer[0m
[2m2026-02-01T13:23:52.513320Z[0m [[32m[1minfo     [0m] [1mQuery parsed: python developer, Role: python developer[0m
[2m2026-02-01T13:23:52.514341Z[0m [[32m[1minfo     [0m] [1mRealTimeWebScraper: Searching for 'python developer'[0m
[2m2026-02-01T13:23:56.842657Z[0m [[31m[1merror    [0m] [1mRealTimeWebScraper failed: [0m
[2m2026-02-01T13:23:56.842657Z[0m [[32m[1minfo     [0m] [1mFetched 0 raw leads           [0m [36mtelemetry[0m=[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4329.34, 'leads_found': 0}}[0m
[2m2026-02-01T13:23:56.842657Z[0m [[31m[1mcritical [0m] [1mHEALTH CHECK FAILED: 0 leads fetched[0m [36mtelemetry[0m=[35m{'MockCompanyAPI': {'status': 'success', 'latency_ms': 0.0, 'leads_found': 0}, 'RealTimeWebScraper': {'status': 'success', 'latency_ms': 4329.34, 'leads_found': 0}}[0m
[2m2026-02-01T13:23:56.842657Z[0m [[32m[1minfo     [0m] [1mEnriched 0 leads with intelligence data[0m
______________________________ test_determinism _______________________________

    @pytest.mark.asyncio
    async def test_determinism():
        """Test 1: Stability Test (No randomness)"""
        query = "Urgently need senior AI engineers in Bangalore"
>       results = await asyncio.gather(*[IntelligenceEngine.process(query) for _ in range(20)])
                        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_strict_compliance.py:19: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

return_exceptions = False
coros_or_futures = (IntelligenceResult(intent='hiring', role='Engineer', skills=['Python'], experience=5, seniority='Senior', location='R...r', location='Remote', hiring_pressure=0.8, role_scarcity=0.7, outsourcing_likelihood=0.1, market_difficulty=0.6), ...)
loop = None
_done_callback = <function gather.<locals>._done_callback at 0x00000286E151B240>

    def gather(*coros_or_futures, return_exceptions=False):
        """Return a future aggregating results from the given coroutines/futures.
    
        Coroutines will be wrapped in a future and scheduled in the event
        loop. They will not necessarily be scheduled in the same order as
        passed in.
    
        All futures must share the same event loop.  If all the tasks are
        done successfully, the returned future's result is the list of
        results (in the order of the original sequence, not necessarily
        the order of results arrival).  If *return_exceptions* is True,
        exceptions in the tasks are treated the same as successful
        results, and gathered in the result list; otherwise, the first
        raised exception will be immediately propagated to the returned
        future.
    
        Cancellation: if the outer Future is cancelled, all children (that
        have not completed yet) are also cancelled.  If any child is
        cancelled, this is treated as if it raised CancelledError --
        the outer Future is *not* cancelled in this case.  (This is to
        prevent the cancellation of one child to cause other children to
        be cancelled.)
    
        If *return_exceptions* is False, cancelling gather() after it
        has been marked done won't cancel any submitted awaitables.
        For instance, gather can be marked done after propagating an
        exception to the caller, therefore, calling ``gather.cancel()``
        after catching an exception (raised by one of the awaitables) from
        gather won't cancel any other awaitables.
        """
        if not coros_or_futures:
            loop = events.get_event_loop()
            outer = loop.create_future()
            outer.set_result([])
            return outer
    
        def _done_callback(fut):
            nonlocal nfinished
            nfinished += 1
    
            if outer is None or outer.done():
                if not fut.cancelled():
                    # Mark exception retrieved.
                    fut.exception()
                return
    
            if not return_exceptions:
                if fut.cancelled():
                    # Check if 'fut' is cancelled first, as
                    # 'fut.exception()' will *raise* a CancelledError
                    # instead of returning it.
                    exc = fut._make_cancelled_error()
                    outer.set_exception(exc)
                    return
                else:
                    exc = fut.exception()
                    if exc is not None:
                        outer.set_exception(exc)
                        return
    
            if nfinished == nfuts:
                # All futures are done; create a list of results
                # and set it to the 'outer' future.
                results = []
    
                for fut in children:
                    if fut.cancelled():
                        # Check if 'fut' is cancelled first, as 'fut.exception()'
                        # will *raise* a CancelledError instead of returning it.
                        # Also, since we're adding the exception return value
                        # to 'results' instead of raising it, don't bother
                        # setting __context__.  This also lets us preserve
                        # calling '_make_cancelled_error()' at most once.
                        res = exceptions.CancelledError(
                            '' if fut._cancel_message is None else
                            fut._cancel_message)
                    else:
                        res = fut.exception()
                        if res is None:
                            res = fut.result()
                    results.append(res)
    
                if outer._cancel_requested:
                    # If gather is being cancelled we must propagate the
                    # cancellation regardless of *return_exceptions* argument.
                    # See issue 32684.
                    exc = fut._make_cancelled_error()
                    outer.set_exception(exc)
                else:
                    outer.set_result(results)
    
        arg_to_fut = {}
        children = []
        nfuts = 0
        nfinished = 0
        done_futs = []
        loop = None
        outer = None  # bpo-46672
        for arg in coros_or_futures:
>           if arg not in arg_to_fut:
               ^^^^^^^^^^^^^^^^^^^^^
E           TypeError: unhashable type: 'IntelligenceResult'

..\..\..\AppData\Local\Programs\Python\Python312\Lib\asyncio\tasks.py:830: TypeError
______________________________ test_sensitivity _______________________________

    @pytest.mark.asyncio
    async def test_sensitivity():
        """Test 2: Sensitivity Test (Small change -> small shift)"""
        q1 = "Find junior frontend developers in Jaipur"
        q2 = "Find senior frontend developers in Jaipur"
    
>       r1 = await IntelligenceEngine.process(q1)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_strict_compliance.py:35: TypeError
__________________________ test_location_competition __________________________

    @pytest.mark.asyncio
    async def test_location_competition():
        """Test 3: Location Intelligence"""
>       bangalore = await IntelligenceEngine.process("Find AI engineers in Bangalore")
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_strict_compliance.py:44: TypeError
_____________________________ test_intent_control _____________________________

    @pytest.mark.asyncio
    async def test_intent_control():
        """Test 4: Intent Control"""
>       hiring = await IntelligenceEngine.process("Find ML engineers in Pune")
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_strict_compliance.py:54: TypeError
_____________________________ test_broken_grammar _____________________________

    @pytest.mark.asyncio
    async def test_broken_grammar():
        """Test 5: Broken Grammar"""
        query = "need 4 ai dev blr asap"
>       r = await IntelligenceEngine.process(query)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_strict_compliance.py:69: TypeError
________________________________ test_aliases _________________________________

    @pytest.mark.asyncio
    async def test_aliases():
        """Test 6: Slang + Shortcuts"""
        query = "Looking 4 ML devs in Blr"
>       r = await IntelligenceEngine.process(query)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_strict_compliance.py:79: TypeError
_________________________________ test_noise __________________________________

    @pytest.mark.asyncio
    async def test_noise():
        """Test 7: Noise Injection"""
        query = "Hey buddy pls help me find some good senior backend engineers in delhi ok?"
>       r = await IntelligenceEngine.process(query)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       TypeError: object IntelligenceResult can't be used in 'await' expression

tests\test_strict_compliance.py:88: TypeError
____________________________ test_e2e_api_contract ____________________________

    def test_e2e_api_contract():
        """Test 8: End-to-End API Contract"""
        payload = {
            "query": "Urgently need senior AI engineers in Bangalore",
            "recruiter_id": "2"
        }
    
        # Create Query
        response = client.post("/api/recruiter/query", json=payload)
        if response.status_code == 404:
            pytest.skip("API endpoint not found (check route prefix)")
    
        assert response.status_code == 200
        data = response.json()
        query_id = data.get("query_id")
        assert query_id is not None
    
        # Poll status
        status_response = client.get(f"/api/recruiter/query/{query_id}")
>       assert status_response.status_code == 200
E       assert 404 == 200
E        +  where 404 = <Response [404 Not Found]>.status_code

tests\test_strict_compliance.py:119: AssertionError
---------------------------- Captured stdout call -----------------------------
\x1b[2m2026-02-01T13:23:56.980517Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:23:56.982031Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mParsed JSON input             \x1b[0m \x1b[36mcontent_type\x1b[0m=\x1b[35mapplication/json\x1b[0m\n\x1b[2m2026-02-01T13:23:56.982031Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mInput normalized successfully \x1b[0m \x1b[36mhas_recruiter_id\x1b[0m=\x1b[35mTrue\x1b[0m \x1b[36mquery_length\x1b[0m=\x1b[35m46\x1b[0m\n\x1b[2m2026-02-01T13:23:56.984395Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mJob created and queued for processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mUrgently need senior AI engineers in Bangalore\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35m2\x1b[0m\n\x1b[2m2026-02-01T13:23:56.984395Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mPOST\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m0.004\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m200\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query\x1b[0m\n\x1b[2m2026-02-01T13:23:56.984395Z\x1b[0m [\x1b[33m\x1b[1mwarning  \x1b[0m] \x1b[1m\u26a0\ufe0f JOB_ALREADY_IN_PROCESSING  \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m \x1b[36mstatus\x1b[0m=\x1b[35mprocessing\x1b[0m\n\x1b[2m2026-02-01T13:23:56.984395Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\U0001f680 JOB_STARTED                 \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mmax_attempts\x1b[0m=\x1b[35m3\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m\n\x1b[2m2026-02-01T13:23:56.984395Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStarting recruiter query processing\x1b[0m \x1b[36mquery\x1b[0m=\x1b[35mUrgently need senior AI engineers in Bangalore\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m \x1b[36mrecruiter_id\x1b[0m=\x1b[35m2\x1b[0m\n\x1b[2m2026-02-01T13:23:56.984395Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mStep 1: Intelligence Engine   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m\n\x1b[2m2026-02-01T13:23:56.987011Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mPipeline processing failed    \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mobject IntelligenceResult can't be used in 'await' expression\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m\n\x1b[2m2026-02-01T13:23:56.987011Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1m\u2705 JOB_COMPLETED_SUCCESSFULLY  \x1b[0m \x1b[36mattempt\x1b[0m=\x1b[35m1\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m\n\x1b[2m2026-02-01T13:23:56.992059Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request started          \x1b[0m \x1b[36mclient_ip\x1b[0m=\x1b[35mtestclient\x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m\n\x1b[2m2026-02-01T13:23:56.993064Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mGetting query status          \x1b[0m \x1b[36midentity\x1b[0m=\x1b[35manonymous\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m\n\x1b[2m2026-02-01T13:23:56.993064Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline get_query_status called\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m\n\x1b[2m2026-02-01T13:24:04.227494Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery status retrieval failed \x1b[0m \x1b[36merror\x1b[0m=\x1b[35mError 11001 connecting to mock-redis:6379. 11001.\x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m\n\x1b[2m2026-02-01T13:24:04.227494Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mPipeline result               \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m \x1b[36mresult\x1b[0m=\x1b[35mNone\x1b[0m\n\x1b[2m2026-02-01T13:24:04.227494Z\x1b[0m [\x1b[31m\x1b[1merror    \x1b[0m] \x1b[1mQuery not found in pipeline   \x1b[0m \x1b[36mquery_id\x1b[0m=\x1b[35m01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m\n\x1b[2m2026-02-01T13:24:04.227494Z\x1b[0m [\x1b[32m\x1b[1minfo     \x1b[0m] \x1b[1mHTTP request completed        \x1b[0m \x1b[36mmethod\x1b[0m=\x1b[35mGET\x1b[0m \x1b[36mprocess_time\x1b[0m=\x1b[35m7.235\x1b[0m \x1b[36mstatus_code\x1b[0m=\x1b[35m404\x1b[0m \x1b[36murl\x1b[0m=\x1b[35mhttp://testserver/api/recruiter/query/01efe19b-41e0-4154-9002-a6990e28f6b3\x1b[0m
_______________________ test_async_completion_guarantee _______________________

    @pytest.mark.asyncio
    async def test_async_completion_guarantee():
        """Test 9: Async Completion Guarantee"""
        # This requires running the actual pipeline in async mode
        # We will simulate calling the pipeline service directly to ensure async safety
    
        pipeline = RecruiterPipeline()
        await pipeline.initialize()
    
        tasks = []
        for i in range(5): # Reduced from 10 for speed in test env
            tasks.append(pipeline.process_recruiter_query(f"Find ML engineers in city {i}", recruiter_id="2"))
    
        results = await asyncio.gather(*tasks)
    
        for res in results:
            assert res["status"] == "completed" or res["status"] == "failed"
>           assert res["processing_time"] > 0
E           assert 0.0 > 0

tests\test_strict_compliance.py:150: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:04.240750Z[0m [[32m[1minfo     [0m] [1mRecruiter pipeline initialized and verified[0m
[2m2026-02-01T13:24:04.240750Z[0m [[32m[1minfo     [0m] [1mStarting recruiter query processing[0m [36mquery[0m=[35mFind ML engineers in city 0[0m [36mquery_id[0m=[35m61c3373e-ba5a-4dbf-bd1f-91530ed1516d[0m [36mrecruiter_id[0m=[35m2[0m
[2m2026-02-01T13:24:04.240750Z[0m [[32m[1minfo     [0m] [1mStep 1: Intelligence Engine   [0m [36mquery_id[0m=[35m61c3373e-ba5a-4dbf-bd1f-91530ed1516d[0m
[2m2026-02-01T13:24:04.240750Z[0m [[31m[1merror    [0m] [1mPipeline processing failed    [0m [36merror[0m=[35mobject IntelligenceResult can't be used in 'await' expression[0m [36mquery_id[0m=[35m61c3373e-ba5a-4dbf-bd1f-91530ed1516d[0m
[2m2026-02-01T13:24:04.246898Z[0m [[32m[1minfo     [0m] [1mStarting recruiter query processing[0m [36mquery[0m=[35mFind ML engineers in city 1[0m [36mquery_id[0m=[35m81f945e9-6673-46be-93f6-8b66c19fc243[0m [36mrecruiter_id[0m=[35m2[0m
[2m2026-02-01T13:24:04.246898Z[0m [[32m[1minfo     [0m] [1mStep 1: Intelligence Engine   [0m [36mquery_id[0m=[35m81f945e9-6673-46be-93f6-8b66c19fc243[0m
[2m2026-02-01T13:24:04.248347Z[0m [[31m[1merror    [0m] [1mPipeline processing failed    [0m [36merror[0m=[35mobject IntelligenceResult can't be used in 'await' expression[0m [36mquery_id[0m=[35m81f945e9-6673-46be-93f6-8b66c19fc243[0m
[2m2026-02-01T13:24:04.248347Z[0m [[32m[1minfo     [0m] [1mStarting recruiter query processing[0m [36mquery[0m=[35mFind ML engineers in city 2[0m [36mquery_id[0m=[35m63e848b6-0688-4543-a05c-30b9939167db[0m [36mrecruiter_id[0m=[35m2[0m
[2m2026-02-01T13:24:04.248347Z[0m [[32m[1minfo     [0m] [1mStep 1: Intelligence Engine   [0m [36mquery_id[0m=[35m63e848b6-0688-4543-a05c-30b9939167db[0m
[2m2026-02-01T13:24:04.248347Z[0m [[31m[1merror    [0m] [1mPipeline processing failed    [0m [36merror[0m=[35mobject IntelligenceResult can't be used in 'await' expression[0m [36mquery_id[0m=[35m63e848b6-0688-4543-a05c-30b9939167db[0m
[2m2026-02-01T13:24:04.248347Z[0m [[32m[1minfo     [0m] [1mStarting recruiter query processing[0m [36mquery[0m=[35mFind ML engineers in city 3[0m [36mquery_id[0m=[35m2a1219ca-f132-4b69-b7a1-e04102ca9b88[0m [36mrecruiter_id[0m=[35m2[0m
[2m2026-02-01T13:24:04.248347Z[0m [[32m[1minfo     [0m] [1mStep 1: Intelligence Engine   [0m [36mquery_id[0m=[35m2a1219ca-f132-4b69-b7a1-e04102ca9b88[0m
[2m2026-02-01T13:24:04.248347Z[0m [[31m[1merror    [0m] [1mPipeline processing failed    [0m [36merror[0m=[35mobject IntelligenceResult can't be used in 'await' expression[0m [36mquery_id[0m=[35m2a1219ca-f132-4b69-b7a1-e04102ca9b88[0m
[2m2026-02-01T13:24:04.251820Z[0m [[32m[1minfo     [0m] [1mStarting recruiter query processing[0m [36mquery[0m=[35mFind ML engineers in city 4[0m [36mquery_id[0m=[35m6aab6a25-70ba-4a65-8540-5f5d2baf8576[0m [36mrecruiter_id[0m=[35m2[0m
[2m2026-02-01T13:24:04.251820Z[0m [[32m[1minfo     [0m] [1mStep 1: Intelligence Engine   [0m [36mquery_id[0m=[35m6aab6a25-70ba-4a65-8540-5f5d2baf8576[0m
[2m2026-02-01T13:24:04.251820Z[0m [[31m[1merror    [0m] [1mPipeline processing failed    [0m [36merror[0m=[35mobject IntelligenceResult can't be used in 'await' expression[0m [36mquery_id[0m=[35m6aab6a25-70ba-4a65-8540-5f5d2baf8576[0m
____________________________ test_schema_integrity ____________________________

    def test_schema_integrity():
        """Test 11: Schema validation"""
        # Check if tables exist and columns are correct type in generic way
        from sqlalchemy import inspect
        inspector = inspect(engine)
    
>       columns = {col['name']: col for col in inspector.get_columns('queries')}
                                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

tests\test_strict_compliance.py:167: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\reflection.py:859: in get_columns
    col_defs = self.dialect.get_columns(
<string>:2: in get_columns
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\reflection.py:97: in cache
    ret = fn(self, con, *args, **kw)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
connection = <sqlalchemy.engine.base.Connection object at 0x00000286E03D4C20>
table_name = 'queries', schema = None, kw = {'info_cache': {}}
pragma = 'table_xinfo', info = [], columns = [], tablesql = None

    @reflection.cache
    def get_columns(self, connection, table_name, schema=None, **kw):
        pragma = "table_info"
        # computed columns are threaded as hidden, they require table_xinfo
        if self.server_version_info >= (3, 31):
            pragma = "table_xinfo"
        info = self._get_table_pragma(
            connection, pragma, table_name, schema=schema
        )
        columns = []
        tablesql = None
        for row in info:
            name = row[1]
            type_ = row[2].upper()
            nullable = not row[3]
            default = row[4]
            primary_key = row[5]
            hidden = row[6] if pragma == "table_xinfo" else 0
    
            # hidden has value 0 for normal columns, 1 for hidden columns,
            # 2 for computed virtual columns and 3 for computed stored columns
            # https://www.sqlite.org/src/info/069351b85f9a706f60d3e98fbc8aaf40c374356b967c0464aede30ead3d9d18b
            if hidden == 1:
                continue
    
            generated = bool(hidden)
            persisted = hidden == 3
    
            if tablesql is None and generated:
                tablesql = self._get_table_sql(
                    connection, table_name, schema, **kw
                )
    
            columns.append(
                self._get_column_info(
                    name,
                    type_,
                    nullable,
                    default,
                    primary_key,
                    generated,
                    persisted,
                    tablesql,
                )
            )
        if columns:
            return columns
        elif not self.has_table(connection, table_name, schema):
>           raise exc.NoSuchTableError(
                f"{schema}.{table_name}" if schema else table_name
            )
E           sqlalchemy.exc.NoSuchTableError: queries

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\dialects\sqlite\base.py:2250: NoSuchTableError
_________________________ test_transaction_atomicity __________________________

self = <sqlalchemy.engine.base.Connection object at 0x00000286E0443410>
dialect = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286DFBCB230>
statement = <sqlalchemy.dialects.sqlite.base.SQLiteCompiler object at 0x00000286E0443230>
parameters = [('test_atomicity', None, 'test', None, 'pending', 0.0, ...)]

    def _exec_single_context(
        self,
        dialect: Dialect,
        context: ExecutionContext,
        statement: Union[str, Compiled],
        parameters: Optional[_AnyMultiExecuteParams],
    ) -> CursorResult[Any]:
        """continue the _execute_context() method for a single DBAPI
        cursor.execute() or cursor.executemany() call.
    
        """
        if dialect.bind_typing is BindTyping.SETINPUTSIZES:
            generic_setinputsizes = context._prepare_set_input_sizes()
    
            if generic_setinputsizes:
                try:
                    dialect.do_set_input_sizes(
                        context.cursor, generic_setinputsizes, context
                    )
                except BaseException as e:
                    self._handle_dbapi_exception(
                        e, str(statement), parameters, None, context
                    )
    
        cursor, str_statement, parameters = (
            context.cursor,
            context.statement,
            context.parameters,
        )
    
        effective_parameters: Optional[_AnyExecuteParams]
    
        if not context.executemany:
            effective_parameters = parameters[0]
        else:
            effective_parameters = parameters
    
        if self._has_events or self.engine._has_events:
            for fn in self.dispatch.before_cursor_execute:
                str_statement, effective_parameters = fn(
                    self,
                    cursor,
                    str_statement,
                    effective_parameters,
                    context,
                    context.executemany,
                )
    
        if self._echo:
            self._log_info(str_statement)
    
            stats = context._get_cache_stats()
    
            if not self.engine.hide_parameters:
                self._log_info(
                    "[%s] %r",
                    stats,
                    sql_util._repr_params(
                        effective_parameters,
                        batches=10,
                        ismulti=context.executemany,
                    ),
                )
            else:
                self._log_info(
                    "[%s] [SQL parameters hidden due to hide_parameters=True]",
                    stats,
                )
    
        evt_handled: bool = False
        try:
            if context.execute_style is ExecuteStyle.EXECUTEMANY:
                effective_parameters = cast(
                    "_CoreMultiExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_executemany:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_executemany(
                        cursor,
                        str_statement,
                        effective_parameters,
                        context,
                    )
            elif not effective_parameters and context.no_parameters:
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute_no_params:
                        if fn(cursor, str_statement, context):
                            evt_handled = True
                            break
                if not evt_handled:
                    self.dialect.do_execute_no_params(
                        cursor, str_statement, context
                    )
            else:
                effective_parameters = cast(
                    "_CoreSingleExecuteParams", effective_parameters
                )
                if self.dialect._has_events:
                    for fn in self.dialect.dispatch.do_execute:
                        if fn(
                            cursor,
                            str_statement,
                            effective_parameters,
                            context,
                        ):
                            evt_handled = True
                            break
                if not evt_handled:
>                   self.dialect.do_execute(
                        cursor, str_statement, effective_parameters, context
                    )

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1969: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
cursor = <sqlite3.Cursor object at 0x00000286E162AAC0>
statement = 'INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at'
parameters = ('test_atomicity', None, 'test', None, 'pending', 0.0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286DFBCB230>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlite3.OperationalError: no such table: queries

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\default.py:922: OperationalError

The above exception was the direct cause of the following exception:

    def test_transaction_atomicity():
        """Test 12: Transaction Atomicity (Simulated)"""
        # We will manually try to create a scenario where we rollback
        db = SessionLocal()
        try:
            # Create a query
            q = Query(id="test_atomicity", query_text="test", processing_status="pending")
            db.add(q)
>           db.commit()

tests\test_strict_compliance.py:181: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1969: in commit
    trans.commit(_to_root=True)
<string>:2: in commit
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1256: in commit
    self._prepare_impl()
<string>:2: in _prepare_impl
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\state_changes.py:139: in _go
    ret_value = fn(self, *arg, **kw)
                ^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:1231: in _prepare_impl
    self.session.flush()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4312: in flush
    self._flush(objects)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4447: in _flush
    with util.safe_reraise():
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\util\langhelpers.py:146: in __exit__
    raise exc_value.with_traceback(exc_tb)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:4408: in _flush
    flush_context.execute()
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\unitofwork.py:466: in execute
    rec.execute(self)
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\unitofwork.py:642: in execute
    util.preloaded.orm_persistence.save_obj(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\persistence.py:93: in save_obj
    _emit_insert_statements(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\persistence.py:1226: in _emit_insert_statements
    result = connection.execute(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1416: in execute
    return meth(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\sql\elements.py:516: in _execute_on_connection
    return connection._execute_clauseelement(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1639: in _execute_clauseelement
    ret = self._execute_context(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1848: in _execute_context
    return self._exec_single_context(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1988: in _exec_single_context
    self._handle_dbapi_exception(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:2343: in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\base.py:1969: in _exec_single_context
    self.dialect.do_execute(
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.dialects.sqlite.pysqlite.SQLiteDialect_pysqlite object at 0x00000286DE222E10>
cursor = <sqlite3.Cursor object at 0x00000286E162AAC0>
statement = 'INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at'
parameters = ('test_atomicity', None, 'test', None, 'pending', 0.0, ...)
context = <sqlalchemy.dialects.sqlite.base.SQLiteExecutionContext object at 0x00000286DFBCB230>

    def do_execute(self, cursor, statement, parameters, context=None):
>       cursor.execute(statement, parameters)
E       sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such table: queries
E       [SQL: INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
E       [parameters: ('test_atomicity', None, 'test', None, 'pending', 0.0, None, '[]', None, None)]
E       (Background on this error at: https://sqlalche.me/e/20/e3q8)

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\engine\default.py:922: OperationalError

During handling of the above exception, another exception occurred:

    def test_transaction_atomicity():
        """Test 12: Transaction Atomicity (Simulated)"""
        # We will manually try to create a scenario where we rollback
        db = SessionLocal()
        try:
            # Create a query
            q = Query(id="test_atomicity", query_text="test", processing_status="pending")
            db.add(q)
            db.commit()
    
            # Start a transaction that fails
            try:
                q.processing_status = "processing"
                # Force error by adding a lead with invalid data if we enforce it, or just raise exception
                raise Exception("Forced Failure")
            except:
                db.rollback()
    
            # Check state matches pre-transaction
            q_check = db.query(Query).filter(Query.id == "test_atomicity").first()
            assert q_check.processing_status == "pending"
    
        finally:
            # Cleanup
>           db.query(Query).filter(Query.id == "test_atomicity").delete()

tests\test_strict_compliance.py:197: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\query.py:3181: in delete
    result: CursorResult[Any] = self.session.execute(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:2308: in execute
    return self._execute_internal(
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:2180: in _execute_internal
    conn = self._connection_for_bind(bind)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:2047: in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
<string>:2: in _connection_for_bind
    ???
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\state_changes.py:103: in _go
    self._raise_for_prerequisite_state(fn.__name__, current_state)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

self = <sqlalchemy.orm.session.SessionTransaction object at 0x00000286E015C5D0>
operation_name = '_connection_for_bind'
state = <SessionTransactionState.DEACTIVE: 4>

    def _raise_for_prerequisite_state(
        self, operation_name: str, state: _StateChangeState
    ) -> NoReturn:
        if state is SessionTransactionState.DEACTIVE:
            if self._rollback_exception:
>               raise sa_exc.PendingRollbackError(
                    "This Session's transaction has been rolled back "
                    "due to a previous exception during flush."
                    " To begin a new transaction with this Session, "
                    "first issue Session.rollback()."
                    f" Original exception was: {self._rollback_exception}",
                    code="7s2a",
                )
E               sqlalchemy.exc.PendingRollbackError: This Session's transaction has been rolled back due to a previous exception during flush. To begin a new transaction with this Session, first issue Session.rollback(). Original exception was: (sqlite3.OperationalError) no such table: queries
E               [SQL: INSERT INTO queries (id, recruiter_id, query_text, confidence_score, processing_status, total_cost, execution_time, tools_used, synthesis_report, completed_at) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?) RETURNING created_at]
E               [parameters: ('test_atomicity', None, 'test', None, 'pending', 0.0, None, '[]', None, None)]
E               (Background on this error at: https://sqlalche.me/e/20/e3q8) (Background on this error at: https://sqlalche.me/e/20/7s2a)

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\sqlalchemy\orm\session.py:929: PendingRollbackError
____ TestTotalLeadsFoundContract.test_total_leads_found_matches_raw_leads _____

self = <tests.test_total_leads_contract.TestTotalLeadsFoundContract object at 0x00000286DFA7C530>

    @pytest.mark.asyncio
    async def test_total_leads_found_matches_raw_leads(self):
        """total_leads_found must equal raw_leads_found from ExecutionReport."""
        from app.services.pipeline import RecruiterPipeline
    
        pipeline = RecruiterPipeline()
        await pipeline.initialize()
    
        result = await pipeline.process_recruiter_query(
            "Senior Python Developer San Francisco",
            recruiter_id="contract-test-001"
        )
    
        # Get values
        total_leads_found = result.get("total_leads_found")
        leads_count = len(result.get("leads", []))
        execution_report = result.get("execution_report_dto")
    
        # Assert leads exist
>       assert leads_count > 0, "Test requires leads to be generated"
E       AssertionError: Test requires leads to be generated
E       assert 0 > 0

tests\test_total_leads_contract.py:35: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:04.869167Z[0m [[32m[1minfo     [0m] [1mRecruiter pipeline initialized and verified[0m
[2m2026-02-01T13:24:04.869167Z[0m [[32m[1minfo     [0m] [1mStarting recruiter query processing[0m [36mquery[0m=[35mSenior Python Developer San Francisco[0m [36mquery_id[0m=[35m2f9cb55b-2c63-4106-9cc3-3ecee649e829[0m [36mrecruiter_id[0m=[35mcontract-test-001[0m
[2m2026-02-01T13:24:04.869167Z[0m [[32m[1minfo     [0m] [1mStep 1: Intelligence Engine   [0m [36mquery_id[0m=[35m2f9cb55b-2c63-4106-9cc3-3ecee649e829[0m
[2m2026-02-01T13:24:04.869167Z[0m [[31m[1merror    [0m] [1mPipeline processing failed    [0m [36merror[0m=[35mobject IntelligenceResult can't be used in 'await' expression[0m [36mquery_id[0m=[35m2f9cb55b-2c63-4106-9cc3-3ecee649e829[0m
______ TestTotalLeadsFoundContract.test_orchestration_summary_populated _______

self = <tests.test_total_leads_contract.TestTotalLeadsFoundContract object at 0x00000286DFA5DCA0>

    @pytest.mark.asyncio
    async def test_orchestration_summary_populated(self):
        """orchestration_summary must be populated with ExecutionReport data."""
        from app.services.pipeline import RecruiterPipeline
    
        pipeline = RecruiterPipeline()
        await pipeline.initialize()
    
        result = await pipeline.process_recruiter_query(
            "Machine Learning Engineer",
            recruiter_id="contract-test-002"
        )
    
        summary = result.get("orchestration_summary")
>       assert summary is not None, "orchestration_summary must not be None"
E       AssertionError: orchestration_summary must not be None
E       assert None is not None

tests\test_total_leads_contract.py:64: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:04.889403Z[0m [[32m[1minfo     [0m] [1mRecruiter pipeline initialized and verified[0m
[2m2026-02-01T13:24:04.889403Z[0m [[32m[1minfo     [0m] [1mStarting recruiter query processing[0m [36mquery[0m=[35mMachine Learning Engineer[0m [36mquery_id[0m=[35m72a8e5b7-1165-4654-a3df-1b793add7a7b[0m [36mrecruiter_id[0m=[35mcontract-test-002[0m
[2m2026-02-01T13:24:04.889403Z[0m [[32m[1minfo     [0m] [1mStep 1: Intelligence Engine   [0m [36mquery_id[0m=[35m72a8e5b7-1165-4654-a3df-1b793add7a7b[0m
[2m2026-02-01T13:24:04.889403Z[0m [[31m[1merror    [0m] [1mPipeline processing failed    [0m [36merror[0m=[35mobject IntelligenceResult can't be used in 'await' expression[0m [36mquery_id[0m=[35m72a8e5b7-1165-4654-a3df-1b793add7a7b[0m
_______________________ TestUIRoutes.test_ui_home_page ________________________

self = <tests.test_ui.TestUIRoutes object at 0x00000286DFAA9A30>
client = <starlette.testclient.TestClient object at 0x00000286E03E04A0>

    def test_ui_home_page(self, client):
        """Test home page loads successfully."""
        response = client.get("/ui")
    
        assert response.status_code == 200
        assert "Recruiter AI" in response.text
>       assert "Submit a Recruiter Query" in response.text
E       assert 'Submit a Recruiter Query' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\\n    <title>Recruiter AI | Premium Talent Intelligence</title>\\n    <link rel="stylesheet" href="/static/style.css?v=2.0.2">\\n    <link\\n        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap"\\n        rel="stylesheet">\\n</head>\\n\\n<body>\\n\\n    <!-- Auth Overlay -->\\n    <div id="auth-overlay">\\n        <div class="auth-box">\\n            <h2>\U0001f680 Recruiter AI</h2>\\n            <p>Enter your workspace ID to access the talent intelligence platform.</p>\\n            <input type="text" id="workspace-id" placeholder="e.g. recruiter_john" />\\n            <button class="primary-btn" onclick="authenticate()">Enter Workspace</button>\\n        </div>\\n    </div>\\n\\n    <!-- Main Application -->\\n    <div id="app-container">\\n\\n        <!-- Sidebar -->\\n        <aside>\\n            <div class="brand">\\n                <div class="brand-icon">\u25c6</div>\\n                <span>Recruiter AI</span>\\n            </div>\\n\\n            <div class="section-label">Recent Searches</di...="lead-tag">${escapeHtml(t)}</span>`).join(\\'\\')}\\n                                </div>\\n                            ` : \\'\\'}\\n                            <div class="lead-reason">"${escapeHtml(reason)}"</div>\\n                            <a href="${url}" target="_blank" class="lead-link">View Position \u2192</a>\\n                        </div>\\n                    `;\\n                });\\n\\n                html += \\'</div></div>\\';\\n            } else {\\n                html += `\\n                    <div class="empty-state">\\n                        <div class="empty-state-icon">\U0001f50d</div>\\n                        <p>No candidates found for this search. Try broadening your criteria.</p>\\n                    </div>\\n                `;\\n            }\\n\\n            area.innerHTML = html;\\n        }\\n\\n        function escapeHtml(text) {\\n            if (!text) return \\'\\';\\n            const div = document.createElement(\\'div\\');\\n            div.textContent = text;\\n            return div.innerHTML;\\n        }\\n\\n        function handleEnter(e) {\\n            if (e.key === \\'Enter\\') submitQuery();\\n        }\\n\\n        // Init\\n        checkAuth();\\n    </script>\\n</body>\\n\\n</html>'
E        +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\\n    <title>Recruiter AI | Premium Talent Intelligence</title>\\n    <link rel="stylesheet" href="/static/style.css?v=2.0.2">\\n    <link\\n        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap"\\n        rel="stylesheet">\\n</head>\\n\\n<body>\\n\\n    <!-- Auth Overlay -->\\n    <div id="auth-overlay">\\n        <div class="auth-box">\\n            <h2>\U0001f680 Recruiter AI</h2>\\n            <p>Enter your workspace ID to access the talent intelligence platform.</p>\\n            <input type="text" id="workspace-id" placeholder="e.g. recruiter_john" />\\n            <button class="primary-btn" onclick="authenticate()">Enter Workspace</button>\\n        </div>\\n    </div>\\n\\n    <!-- Main Application -->\\n    <div id="app-container">\\n\\n        <!-- Sidebar -->\\n        <aside>\\n            <div class="brand">\\n                <div class="brand-icon">\u25c6</div>\\n                <span>Recruiter AI</span>\\n            </div>\\n\\n            <div class="section-label">Recent Searches</di...="lead-tag">${escapeHtml(t)}</span>`).join(\\'\\')}\\n                                </div>\\n                            ` : \\'\\'}\\n                            <div class="lead-reason">"${escapeHtml(reason)}"</div>\\n                            <a href="${url}" target="_blank" class="lead-link">View Position \u2192</a>\\n                        </div>\\n                    `;\\n                });\\n\\n                html += \\'</div></div>\\';\\n            } else {\\n                html += `\\n                    <div class="empty-state">\\n                        <div class="empty-state-icon">\U0001f50d</div>\\n                        <p>No candidates found for this search. Try broadening your criteria.</p>\\n                    </div>\\n                `;\\n            }\\n\\n            area.innerHTML = html;\\n        }\\n\\n        function escapeHtml(text) {\\n            if (!text) return \\'\\';\\n            const div = document.createElement(\\'div\\');\\n            div.textContent = text;\\n            return div.innerHTML;\\n        }\\n\\n        function handleEnter(e) {\\n            if (e.key === \\'Enter\\') submitQuery();\\n        }\\n\\n        // Init\\n        checkAuth();\\n    </script>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:26: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.284207Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mGET[0m [36murl[0m=[35mhttp://testserver/ui[0m
[2m2026-02-01T13:24:09.289716Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mGET[0m [36mprocess_time[0m=[35m0.006[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui[0m
________________ TestUIRoutes.test_ui_query_submission_success ________________

self = <tests.test_ui.TestUIRoutes object at 0x00000286DFAA9DC0>
mock_process_query = <AsyncMock name='process_recruiter_query' id='2778310352416'>
client = <starlette.testclient.TestClient object at 0x00000286E01C2960>

    @patch('app.routes.recruiter.process_recruiter_query')
    def test_ui_query_submission_success(self, mock_process_query, client):
        """Test successful query submission via UI."""
        # Mock the process_recruiter_query function
        mock_process_query.return_value = {
            "query_id": "test-123",
            "status": "processing",
            "original_query": "Find Python developers"
        }
    
        response = client.post("/ui/query", data={
            "query": "Find Python developers",
            "recruiter_id": "1"
        })
    
        assert response.status_code == 200
>       assert "Processing Your Query" in response.text
E       assert 'Processing Your Query' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 09dacf98-050c-42ee-afdd-4ae8c504899c</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>'
E        +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 09dacf98-050c-42ee-afdd-4ae8c504899c</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:45: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.309305Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mPOST[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
[2m2026-02-01T13:24:09.311559Z[0m [[32m[1minfo     [0m] [1mUI job created and queued for processing[0m [36mquery[0m=[35mFind Python developers[0m [36mquery_id[0m=[35m09dacf98-050c-42ee-afdd-4ae8c504899c[0m [36mrecruiter_id[0m=[35m1[0m
[2m2026-02-01T13:24:09.319834Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mPOST[0m [36mprocess_time[0m=[35m0.011[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
_______________ TestUIRoutes.test_ui_query_submission_completed _______________

self = <tests.test_ui.TestUIRoutes object at 0x00000286DFAAA150>
mock_process_query = <AsyncMock name='process_recruiter_query' id='2778311618208'>
client = <starlette.testclient.TestClient object at 0x00000286E046EA80>

    @patch('app.routes.recruiter.process_recruiter_query')
    def test_ui_query_submission_completed(self, mock_process_query, client):
        """Test UI query display when completed."""
        # Mock the process_recruiter_query function
        mock_process_query.return_value = {
            "query_id": "test-123",
            "status": "completed",
            "original_query": "Find Python developers",
            "total_leads_found": 2,
            "processing_time": 5.5,
            "leads": [
                {
                    "company": "TechCorp",
                    "score": 0.85,
                    "confidence": 0.9,
                    "evidence_count": 5,
                    "reasons": ["Strong match", "Recent hiring"]
                },
                {
                    "company": "DevInc",
                    "score": 0.75,
                    "confidence": 0.8,
                    "evidence_count": 3,
                    "reasons": ["Good fit"]
                }
            ]
        }
    
        response = client.post("/ui/query", data={
            "query": "Find Python developers"
        })
    
        assert response.status_code == 200
>       assert "Query Completed" in response.text
E       assert 'Query Completed' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 47bd64e1-3196-4b4f-be82-30dc89b89b5f</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>'
E        +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 47bd64e1-3196-4b4f-be82-30dc89b89b5f</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:81: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.339433Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mPOST[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
[2m2026-02-01T13:24:09.339433Z[0m [[32m[1minfo     [0m] [1mUI job created and queued for processing[0m [36mquery[0m=[35mFind Python developers[0m [36mquery_id[0m=[35m47bd64e1-3196-4b4f-be82-30dc89b89b5f[0m [36mrecruiter_id[0m=[35mNone[0m
[2m2026-02-01T13:24:09.339433Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mPOST[0m [36mprocess_time[0m=[35m0.0[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
________________ TestUIRoutes.test_ui_query_submission_failed _________________

self = <tests.test_ui.TestUIRoutes object at 0x00000286DFAAA4E0>
mock_process_query = <AsyncMock name='process_recruiter_query' id='2778311529472'>
client = <starlette.testclient.TestClient object at 0x00000286E045A630>

    @patch('app.routes.recruiter.process_recruiter_query')
    def test_ui_query_submission_failed(self, mock_process_query, client):
        """Test UI query display when failed."""
        # Mock the process_recruiter_query function to raise an exception
        mock_process_query.side_effect = Exception("API Error")
    
        response = client.post("/ui/query", data={
            "query": "Find Python developers"
        })
    
        assert response.status_code == 200
>       assert "Query Failed" in response.text
E       assert 'Query Failed' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 6bf9640d-d0e7-4dcb-a648-4ebd6706be62</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>'
E        +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 6bf9640d-d0e7-4dcb-a648-4ebd6706be62</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:97: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.360033Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mPOST[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
[2m2026-02-01T13:24:09.362209Z[0m [[32m[1minfo     [0m] [1mUI job created and queued for processing[0m [36mquery[0m=[35mFind Python developers[0m [36mquery_id[0m=[35m6bf9640d-d0e7-4dcb-a648-4ebd6706be62[0m [36mrecruiter_id[0m=[35mNone[0m
[2m2026-02-01T13:24:09.362209Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mPOST[0m [36mprocess_time[0m=[35m0.002[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
__________________ TestUIRoutes.test_ui_query_status_polling __________________

self = <tests.test_ui.TestUIRoutes object at 0x00000286DFAAA870>
mock_get_results = <AsyncMock name='get_query_results' id='2778311191744'>
client = <starlette.testclient.TestClient object at 0x00000286E0404590>

    @patch('app.routes.recruiter.get_query_results')
    def test_ui_query_status_polling(self, mock_get_results, client):
        """Test query status polling via UI."""
        # Mock the get_query_results function
        mock_get_results.return_value = {
            "query_id": "test-123",
            "status": "completed",
            "original_query": "Find Python developers",
            "total_leads_found": 1,
            "leads": []
        }
    
        response = client.get("/ui/query/test-123")
    
        assert response.status_code == 200
>       assert "Query Completed" in response.text
E       assert 'Query Completed' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: COMPLETED</h2>\\n            <p style="color: var(--text-secondary);">ID: test-123</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>'
E        +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: COMPLETED</h2>\\n            <p style="color: var(--text-secondary);">ID: test-123</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:115: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.383211Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mGET[0m [36murl[0m=[35mhttp://testserver/ui/query/test-123[0m
[2m2026-02-01T13:24:09.384211Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mGET[0m [36mprocess_time[0m=[35m0.001[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui/query/test-123[0m
______________ TestUIRoutes.test_ui_query_status_polling_failed _______________

self = <tests.test_ui.TestUIRoutes object at 0x00000286DFAAAC00>
mock_get_results = <AsyncMock name='get_query_results' id='2778311210096'>
client = <starlette.testclient.TestClient object at 0x00000286E04580E0>

    @patch('app.routes.recruiter.get_query_results')
    def test_ui_query_status_polling_failed(self, mock_get_results, client):
        """Test query status polling when API fails."""
        # Mock the get_query_results function to raise an exception
        mock_get_results.side_effect = Exception("Connection failed")
    
        response = client.get("/ui/query/test-123")
    
        assert response.status_code == 200
>       assert "Query Failed" in response.text
E       assert 'Query Failed' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: FAILED</h2>\\n            <p style="color: var(--text-secondary);">ID: test-123</p>\\n\\n            \\n            <div style="color: #f85149; background: rgba(248, 81, 73, 0.1); padding: 1rem; border-radius: 6px;">\\n                Error: Failed to check status: Connection failed\\n            </div>\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>'
E        +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: FAILED</h2>\\n            <p style="color: var(--text-secondary);">ID: test-123</p>\\n\\n            \\n            <div style="color: #f85149; background: rgba(248, 81, 73, 0.1); padding: 1rem; border-radius: 6px;">\\n                Error: Failed to check status: Connection failed\\n            </div>\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:127: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.401539Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mGET[0m [36murl[0m=[35mhttp://testserver/ui/query/test-123[0m
[2m2026-02-01T13:24:09.401539Z[0m [[31m[1merror    [0m] [1mUI query status check failed  [0m [36merror[0m=[35mConnection failed[0m [36mquery_id[0m=[35mtest-123[0m
[2m2026-02-01T13:24:09.401539Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mGET[0m [36mprocess_time[0m=[35m0.0[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui/query/test-123[0m
________________ TestUITemplates.test_home_template_structure _________________

self = <tests.test_ui.TestUITemplates object at 0x00000286DFA365A0>
client = <starlette.testclient.TestClient object at 0x00000286E0301D00>

    def test_home_template_structure(self, client):
        """Test home page has correct HTML structure."""
        response = client.get("/ui")
    
        # Check for required HTML elements
        assert "<!DOCTYPE html>" in response.text
>       assert "<form" in response.text
E       assert '<form' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\\n    <title>Recruiter AI | Premium Talent Intelligence</title>\\n    <link rel="stylesheet" href="/static/style.css?v=2.0.2">\\n    <link\\n        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap"\\n        rel="stylesheet">\\n</head>\\n\\n<body>\\n\\n    <!-- Auth Overlay -->\\n    <div id="auth-overlay">\\n        <div class="auth-box">\\n            <h2>\U0001f680 Recruiter AI</h2>\\n            <p>Enter your workspace ID to access the talent intelligence platform.</p>\\n            <input type="text" id="workspace-id" placeholder="e.g. recruiter_john" />\\n            <button class="primary-btn" onclick="authenticate()">Enter Workspace</button>\\n        </div>\\n    </div>\\n\\n    <!-- Main Application -->\\n    <div id="app-container">\\n\\n        <!-- Sidebar -->\\n        <aside>\\n            <div class="brand">\\n                <div class="brand-icon">\u25c6</div>\\n                <span>Recruiter AI</span>\\n            </div>\\n\\n            <div class="section-label">Recent Searches</di...="lead-tag">${escapeHtml(t)}</span>`).join(\\'\\')}\\n                                </div>\\n                            ` : \\'\\'}\\n                            <div class="lead-reason">"${escapeHtml(reason)}"</div>\\n                            <a href="${url}" target="_blank" class="lead-link">View Position \u2192</a>\\n                        </div>\\n                    `;\\n                });\\n\\n                html += \\'</div></div>\\';\\n            } else {\\n                html += `\\n                    <div class="empty-state">\\n                        <div class="empty-state-icon">\U0001f50d</div>\\n                        <p>No candidates found for this search. Try broadening your criteria.</p>\\n                    </div>\\n                `;\\n            }\\n\\n            area.innerHTML = html;\\n        }\\n\\n        function escapeHtml(text) {\\n            if (!text) return \\'\\';\\n            const div = document.createElement(\\'div\\');\\n            div.textContent = text;\\n            return div.innerHTML;\\n        }\\n\\n        function handleEnter(e) {\\n            if (e.key === \\'Enter\\') submitQuery();\\n        }\\n\\n        // Init\\n        checkAuth();\\n    </script>\\n</body>\\n\\n</html>'
E        +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <meta name="viewport" content="width=device-width, initial-scale=1.0">\\n    <title>Recruiter AI | Premium Talent Intelligence</title>\\n    <link rel="stylesheet" href="/static/style.css?v=2.0.2">\\n    <link\\n        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Inter:wght@400;500;600&display=swap"\\n        rel="stylesheet">\\n</head>\\n\\n<body>\\n\\n    <!-- Auth Overlay -->\\n    <div id="auth-overlay">\\n        <div class="auth-box">\\n            <h2>\U0001f680 Recruiter AI</h2>\\n            <p>Enter your workspace ID to access the talent intelligence platform.</p>\\n            <input type="text" id="workspace-id" placeholder="e.g. recruiter_john" />\\n            <button class="primary-btn" onclick="authenticate()">Enter Workspace</button>\\n        </div>\\n    </div>\\n\\n    <!-- Main Application -->\\n    <div id="app-container">\\n\\n        <!-- Sidebar -->\\n        <aside>\\n            <div class="brand">\\n                <div class="brand-icon">\u25c6</div>\\n                <span>Recruiter AI</span>\\n            </div>\\n\\n            <div class="section-label">Recent Searches</di...="lead-tag">${escapeHtml(t)}</span>`).join(\\'\\')}\\n                                </div>\\n                            ` : \\'\\'}\\n                            <div class="lead-reason">"${escapeHtml(reason)}"</div>\\n                            <a href="${url}" target="_blank" class="lead-link">View Position \u2192</a>\\n                        </div>\\n                    `;\\n                });\\n\\n                html += \\'</div></div>\\';\\n            } else {\\n                html += `\\n                    <div class="empty-state">\\n                        <div class="empty-state-icon">\U0001f50d</div>\\n                        <p>No candidates found for this search. Try broadening your criteria.</p>\\n                    </div>\\n                `;\\n            }\\n\\n            area.innerHTML = html;\\n        }\\n\\n        function escapeHtml(text) {\\n            if (!text) return \\'\\';\\n            const div = document.createElement(\\'div\\');\\n            div.textContent = text;\\n            return div.innerHTML;\\n        }\\n\\n        function handleEnter(e) {\\n            if (e.key === \\'Enter\\') submitQuery();\\n        }\\n\\n        // Init\\n        checkAuth();\\n    </script>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:140: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.418843Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mGET[0m [36murl[0m=[35mhttp://testserver/ui[0m
[2m2026-02-01T13:24:09.418843Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mGET[0m [36mprocess_time[0m=[35m0.0[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui[0m
____________ TestUITemplates.test_query_result_template_processing ____________

self = <tests.test_ui.TestUITemplates object at 0x00000286DFA7F440>
client = <starlette.testclient.TestClient object at 0x00000286E01C1B20>

    def test_query_result_template_processing(self, client):
        """Test processing state template."""
        with patch('app.routes.recruiter.process_recruiter_query') as mock_process_query:
            mock_process_query.return_value = {
                "query_id": "test-123",
                "status": "processing",
                "original_query": "Test query"
            }
    
            response = client.post("/ui/query", data={"query": "Test query"})
    
>           assert "Processing Your Query" in response.text
E           assert 'Processing Your Query' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: fe170283-cec0-4ef8-b640-99a8a2e5a8f2</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>'
E            +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: fe170283-cec0-4ef8-b640-99a8a2e5a8f2</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:162: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.437415Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mPOST[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
[2m2026-02-01T13:24:09.439282Z[0m [[32m[1minfo     [0m] [1mUI job created and queued for processing[0m [36mquery[0m=[35mTest query[0m [36mquery_id[0m=[35mfe170283-cec0-4ef8-b640-99a8a2e5a8f2[0m [36mrecruiter_id[0m=[35mNone[0m
[2m2026-02-01T13:24:09.439282Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mPOST[0m [36mprocess_time[0m=[35m0.003[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
____________ TestUITemplates.test_query_result_template_completed _____________

self = <tests.test_ui.TestUITemplates object at 0x00000286DFAAAD80>
client = <starlette.testclient.TestClient object at 0x00000286E046DFA0>

    def test_query_result_template_completed(self, client):
        """Test completed state template."""
        with patch('app.routes.recruiter.process_recruiter_query') as mock_process_query:
            mock_process_query.return_value = {
                "query_id": "test-123",
                "status": "completed",
                "original_query": "Test query",
                "total_leads_found": 1,
                "processing_time": 2.5,
                "leads": [
                    {
                        "company": "TestCompany",
                        "score": 0.9,
                        "confidence": 0.85,
                        "evidence_count": 4,
                        "reasons": ["Good match", "Recent activity"]
                    }
                ]
            }
    
            response = client.post("/ui/query", data={"query": "Test query"})
    
>           assert "Query Completed" in response.text
E           assert 'Query Completed' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 82164884-8def-4340-b409-7ec9614018b5</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>'
E            +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 82164884-8def-4340-b409-7ec9614018b5</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:189: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.457158Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mPOST[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
[2m2026-02-01T13:24:09.459072Z[0m [[32m[1minfo     [0m] [1mUI job created and queued for processing[0m [36mquery[0m=[35mTest query[0m [36mquery_id[0m=[35m82164884-8def-4340-b409-7ec9614018b5[0m [36mrecruiter_id[0m=[35mNone[0m
[2m2026-02-01T13:24:09.459072Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mPOST[0m [36mprocess_time[0m=[35m0.002[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
______________ TestUITemplates.test_query_result_template_failed ______________

self = <tests.test_ui.TestUITemplates object at 0x00000286DFAAA720>
client = <starlette.testclient.TestClient object at 0x00000286E01FB530>

    def test_query_result_template_failed(self, client):
        """Test failed state template."""
        with patch('app.routes.recruiter.process_recruiter_query') as mock_process_query:
            mock_process_query.return_value = {
                "query_id": "test-123",
                "status": "failed",
                "original_query": "Test query",
                "error": "Test error message"
            }
    
            response = client.post("/ui/query", data={"query": "Test query"})
    
>           assert "Query Failed" in response.text
E           assert 'Query Failed' in '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 05c807ce-2122-4c47-8e07-1a2ced5c1116</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>'
E            +  where '<!DOCTYPE html>\\n<html lang="en">\\n\\n<head>\\n    <meta charset="UTF-8">\\n    <title>Query Status | Recruiter AI</title>\\n    <link rel="stylesheet" href="/static/style.css">\\n</head>\\n\\n<body style="padding: 2rem; overflow: auto;">\\n    <div style="max-width: 800px; margin: 0 auto;">\\n        <a href="/ui" class="primary-btn"\\n            style="text-decoration: none; display: inline-block; width: auto; margin-bottom: 2rem;">\u2190 Back to\\n            Dashboard</a>\\n\\n        <div class="briefing-card">\\n            <h2>Status: PROCESSING</h2>\\n            <p style="color: var(--text-secondary);">ID: 05c807ce-2122-4c47-8e07-1a2ced5c1116</p>\\n\\n            \\n\\n            \\n        </div>\\n\\n        \\n    </div>\\n</body>\\n\\n</html>' = <Response [200 OK]>.text

tests\test_ui.py:207: AssertionError
---------------------------- Captured stdout call -----------------------------
[2m2026-02-01T13:24:09.477591Z[0m [[32m[1minfo     [0m] [1mHTTP request started          [0m [36mclient_ip[0m=[35mtestclient[0m [36mmethod[0m=[35mPOST[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
[2m2026-02-01T13:24:09.479661Z[0m [[32m[1minfo     [0m] [1mUI job created and queued for processing[0m [36mquery[0m=[35mTest query[0m [36mquery_id[0m=[35m05c807ce-2122-4c47-8e07-1a2ced5c1116[0m [36mrecruiter_id[0m=[35mNone[0m
[2m2026-02-01T13:24:09.479661Z[0m [[32m[1minfo     [0m] [1mHTTP request completed        [0m [36mmethod[0m=[35mPOST[0m [36mprocess_time[0m=[35m0.002[0m [36mstatus_code[0m=[35m200[0m [36murl[0m=[35mhttp://testserver/ui/query[0m
============================== warnings summary ===============================
..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pydantic\fields.py:799: 43 warnings
  C:\Users\ayush\AppData\Local\Programs\Python\Python312\Lib\site-packages\pydantic\fields.py:799: PydanticDeprecatedSince20: Using extra keyword arguments on `Field` is deprecated and will be removed. Use `json_schema_extra` instead. (Extra keys: 'env'). Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warn(

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\pydantic\_internal\_config.py:268
  C:\Users\ayush\AppData\Local\Programs\Python\Python312\Lib\site-packages\pydantic\_internal\_config.py:268: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.5/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

app\database.py:24
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\database.py:24: MovedIn20Warning: The ``declarative_base()`` function is now available as sqlalchemy.orm.declarative_base(). (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    Base = declarative_base()

app\main.py:391
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\main.py:391: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    @app.on_event("startup")

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\applications.py:4547
  C:\Users\ayush\AppData\Local\Programs\Python\Python312\Lib\site-packages\fastapi\applications.py:4547: DeprecationWarning: 
          on_event is deprecated, use lifespan event handlers instead.
  
          Read more about it in the
          [FastAPI docs for Lifespan Events](https://fastapi.tiangolo.com/advanced/events/).
          
    return self.router.on_event(event_type)

..\..\..\AppData\Local\Programs\Python\Python312\Lib\site-packages\typer\completion.py:122
  C:\Users\ayush\AppData\Local\Programs\Python\Python312\Lib\site-packages\typer\completion.py:122: DeprecationWarning: 'BaseCommand' is deprecated and will be removed in Click 9.0. Use 'Command' instead.
    cli: click.BaseCommand,

tests/test_api.py::TestAPIHealth::test_health_endpoint
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\main.py:372: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "timestamp": datetime.utcnow().isoformat()

tests/test_api.py::TestAPIHealth::test_api_recruiter_health_endpoint
tests/test_api.py::TestAPIRateLimiting::test_concurrent_requests
tests/test_api.py::TestAPIRateLimiting::test_concurrent_requests
tests/test_api.py::TestAPIRateLimiting::test_concurrent_requests
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\routes\recruiter.py:715: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "timestamp": datetime.utcnow().isoformat(),

tests/test_api.py::TestAPIQuerySubmission::test_submit_query_background_processing
tests/test_api.py::TestAPIDataValidation::test_query_request_validation
tests/test_api.py::test_concurrent_job_execution
tests/test_api.py::test_concurrent_job_execution
tests/test_api.py::test_concurrent_job_execution
tests/test_api.py::test_concurrent_job_execution
tests/test_api.py::test_concurrent_job_execution
tests/test_strict_compliance.py::test_e2e_api_contract
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\routes\recruiter.py:256: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow()

tests/test_api.py: 8 warnings
tests/test_api_contract.py: 4 warnings
tests/test_critical_hardening.py: 13 warnings
tests/test_execution_reporting.py: 2 warnings
tests/test_platform_unification.py: 2 warnings
tests/test_strict_compliance.py: 6 warnings
tests/test_total_leads_contract.py: 3 warnings
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\services\pipeline.py:63: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    start_time = datetime.utcnow()

tests/test_api.py: 8 warnings
tests/test_api_contract.py: 4 warnings
tests/test_critical_hardening.py: 12 warnings
tests/test_execution_reporting.py: 2 warnings
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\services\pipeline.py:156: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    processing_time = (datetime.utcnow() - start_time).total_seconds()

tests/test_api.py: 8 warnings
tests/test_api_contract.py: 4 warnings
tests/test_critical_hardening.py: 12 warnings
tests/test_execution_reporting.py: 2 warnings
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\services\pipeline.py:173: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "completed_at": datetime.utcnow().isoformat()

tests/test_api.py: 8 warnings
tests/test_execution_reporting.py: 2 warnings
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\services\pipeline.py:259: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    query.completed_at = datetime.utcnow()

tests/test_api.py::TestAPIErrorHandling::test_invalid_json
tests/test_api.py::TestAPIErrorHandling::test_unsupported_content_type
  C:\Users\ayush\AppData\Local\Programs\Python\Python312\Lib\site-packages\httpx\_content.py:204: DeprecationWarning: Use 'content=<...>' to upload raw bytes/text content.
    warnings.warn(message, DeprecationWarning)

tests/test_api.py::TestAPIMetrics::test_metrics_endpoints_exist
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\routes\recruiter.py:563: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    today = datetime.utcnow().date()

tests/test_api.py::TestAPIMetrics::test_metrics_endpoints_exist
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\routes\recruiter.py:628: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    cutoff_date = datetime.utcnow() - timedelta(days=days)

tests/test_api.py::TestAPIMetrics::test_metrics_endpoints_exist
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\routes\recruiter.py:733: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "timestamp": datetime.utcnow().isoformat()

tests/test_api.py::test_job_recovery_mechanism
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\tests\test_api.py:405: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    old_timestamp = datetime.utcnow() - timedelta(minutes=10)

tests/test_api.py::test_job_recovery_mechanism
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\main.py:418: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    five_minutes_ago = datetime.utcnow() - timedelta(minutes=5)

tests/test_cli.py: 189 warnings
  C:\Users\ayush\AppData\Local\Programs\Python\Python312\Lib\site-packages\typer\_compat_utils.py:5: DeprecationWarning: The '__version__' attribute is deprecated and will be removed in Click 9.1. Use feature detection or 'importlib.metadata.version("click")' instead.
    return int(click.__version__.split(".")[0])

tests/test_critical_hardening.py: 1 warning
tests/test_platform_unification.py: 2 warnings
tests/test_strict_compliance.py: 6 warnings
tests/test_total_leads_contract.py: 3 warnings
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\services\pipeline.py:203: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    query_record.execution_time = (datetime.utcnow() - start_time).total_seconds()

tests/test_critical_hardening.py: 1 warning
tests/test_platform_unification.py: 2 warnings
tests/test_strict_compliance.py: 6 warnings
tests/test_total_leads_contract.py: 3 warnings
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\services\pipeline.py:219: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    "processing_time": (datetime.utcnow() - start_time).total_seconds()

tests/test_query_read_model.py::test_query_status_returns_leads
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\tests\test_query_read_model.py:27: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow()

tests/test_query_read_model.py::test_api_response_serialization
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\tests\test_query_read_model.py:94: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow()

tests/test_query_read_model.py::test_end_to_end_query_and_retrieve
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\tests\test_query_read_model.py:134: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow()

tests/test_ui.py::TestUIRoutes::test_ui_query_submission_success
tests/test_ui.py::TestUIRoutes::test_ui_query_submission_completed
tests/test_ui.py::TestUIRoutes::test_ui_query_submission_failed
tests/test_ui.py::TestUITemplates::test_query_result_template_processing
tests/test_ui.py::TestUITemplates::test_query_result_template_completed
tests/test_ui.py::TestUITemplates::test_query_result_template_failed
  C:\Users\ayush\OneDrive\Desktop\AGENT 2\app\main.py:266: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    created_at=datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_api.py::TestAPIErrorHandling::test_unsupported_content_type
FAILED tests/test_api.py::test_concurrent_job_execution - assert 404 == 200
FAILED tests/test_api.py::test_job_recovery_mechanism - assert None is not None
FAILED tests/test_api.py::test_job_timeout_mechanism - assert 500 == 200
FAILED tests/test_cli.py::TestCLICommands::test_query_command_success - Asser...
FAILED tests/test_cli.py::TestCLICommands::test_query_command_with_wait - ass...
FAILED tests/test_cli.py::TestCLICommands::test_results_command_json_output
FAILED tests/test_contract_validation.py::test_deduplication_metrics_present
FAILED tests/test_critical_hardening.py::test_job_structure_determinism - Ass...
FAILED tests/test_deduplication.py::test_deduplication_skips_empty_company - ...
FAILED tests/test_execution_reporting.py::test_pipeline_persistence - assert ...
FAILED tests/test_full_pipeline.py::test_pipeline_integration_with_search - A...
FAILED tests/test_intelligence_engine.py::test_signal_ordering - TypeError: o...
FAILED tests/test_intelligence_engine.py::test_stability - TypeError: object ...
FAILED tests/test_intelligence_engine.py::test_boundary_general - TypeError: ...
FAILED tests/test_intelligence_engine.py::test_robustness - TypeError: object...
FAILED tests/test_lead_enrichment.py::test_enrichment_fills_required_fields
FAILED tests/test_lead_enrichment.py::test_enriched_lead_passes_contract_validation
FAILED tests/test_lead_enrichment.py::test_end_to_end_enrichment_in_pipeline
FAILED tests/test_lead_scoring.py::test_score_calculation - assert 98.2 == 100.0
FAILED tests/test_lead_scoring.py::test_low_score_calculation - assert 40.0 =...
FAILED tests/test_lead_scoring.py::test_missing_signals - assert 40.0 == 67.5
FAILED tests/test_observability.py::test_orchestration_summary_present - KeyE...
FAILED tests/test_observability.py::test_provider_telemetry_attached - Assert...
FAILED tests/test_pipeline_contract.py::test_lead_contract_strips_unknown_fields
FAILED tests/test_pipeline_contract.py::test_location_contract_end_to_end - T...
FAILED tests/test_pipeline_contract.py::test_partial_failure_handling - asser...
FAILED tests/test_pipeline_stress.py::test_search_orchestrator_respects_location_contract
FAILED tests/test_pipeline_stress.py::test_pipeline_validation_gate_unit - as...
FAILED tests/test_pipeline_stress.py::test_end_to_end_location_contract - Typ...
FAILED tests/test_platform_unification.py::TestStartupIntegrity::test_zero_providers_raises_error
FAILED tests/test_platform_unification.py::TestExecutionConsistency::test_orchestration_summary_populated
FAILED tests/test_production_hardening.py::test_score_soft_cap_prevents_saturation
FAILED tests/test_production_hardening.py::test_deduplication_removes_duplicates
FAILED tests/test_production_hardening.py::test_deduplication_preserves_order
FAILED tests/test_production_hardening.py::test_score_distribution_not_clustered
FAILED tests/test_production_hardening.py::test_end_to_end_hardening - TypeEr...
FAILED tests/test_query_read_model.py::test_query_status_returns_leads - sqla...
FAILED tests/test_query_read_model.py::test_api_response_serialization - sqla...
FAILED tests/test_query_read_model.py::test_end_to_end_query_and_retrieve - s...
FAILED tests/test_search_engine.py::test_lead_normalization_defaults - Attrib...
FAILED tests/test_search_engine.py::test_lead_normalization_with_all_fields
FAILED tests/test_search_engine.py::test_lead_normalization_inference - Attri...
FAILED tests/test_search_integrity.py::test_startup_fails_with_no_providers
FAILED tests/test_search_integrity.py::test_search_mode_provider_logic - Asse...
FAILED tests/test_search_integrity.py::test_telemetry_generation - AssertionE...
FAILED tests/test_strict_compliance.py::test_determinism - TypeError: unhasha...
FAILED tests/test_strict_compliance.py::test_sensitivity - TypeError: object ...
FAILED tests/test_strict_compliance.py::test_location_competition - TypeError...
FAILED tests/test_strict_compliance.py::test_intent_control - TypeError: obje...
FAILED tests/test_strict_compliance.py::test_broken_grammar - TypeError: obje...
FAILED tests/test_strict_compliance.py::test_aliases - TypeError: object Inte...
FAILED tests/test_strict_compliance.py::test_noise - TypeError: object Intell...
FAILED tests/test_strict_compliance.py::test_e2e_api_contract - assert 404 ==...
FAILED tests/test_strict_compliance.py::test_async_completion_guarantee - ass...
FAILED tests/test_strict_compliance.py::test_schema_integrity - sqlalchemy.ex...
FAILED tests/test_strict_compliance.py::test_transaction_atomicity - sqlalche...
FAILED tests/test_total_leads_contract.py::TestTotalLeadsFoundContract::test_total_leads_found_matches_raw_leads
FAILED tests/test_total_leads_contract.py::TestTotalLeadsFoundContract::test_orchestration_summary_populated
FAILED tests/test_ui.py::TestUIRoutes::test_ui_home_page - assert 'Submit a R...
FAILED tests/test_ui.py::TestUIRoutes::test_ui_query_submission_success - ass...
FAILED tests/test_ui.py::TestUIRoutes::test_ui_query_submission_completed - a...
FAILED tests/test_ui.py::TestUIRoutes::test_ui_query_submission_failed - asse...
FAILED tests/test_ui.py::TestUIRoutes::test_ui_query_status_polling - assert ...
FAILED tests/test_ui.py::TestUIRoutes::test_ui_query_status_polling_failed - ...
FAILED tests/test_ui.py::TestUITemplates::test_home_template_structure - asse...
FAILED tests/test_ui.py::TestUITemplates::test_query_result_template_processing
FAILED tests/test_ui.py::TestUITemplates::test_query_result_template_completed
FAILED tests/test_ui.py::TestUITemplates::test_query_result_template_failed
===== 69 failed, 106 passed, 1 skipped, 390 warnings in 304.54s (0:05:04) =====
